!function(){"use strict";var t;!function(t){t.PlayEarnAni="PlayEarnAni",t.PlayEarnTipsAni="PlayEarnTipsAni",t.PlayFx="PlayFx",t.AddTask="AddTask",t.LevelInit="LevelInit",t.LevelClear="LevelClear",t.ItemRemove="ItemRemove",t.AddStar="AddStar",t.UseTool="UseTool",t.WakeUp="WakeUp",t.PlayHammer="PlayHammer",t.RefreshBg="RefreshBg",t.PlayRemoveTips="PlayRemoveTips",t.coin_change="coin_change"}(t||(t={}));var e;function __awaiter(t,e,a,i){return new(a||(a=Promise))(function(s,o){function fulfilled(t){try{step(i.next(t))}catch(t){o(t)}}function rejected(t){try{step(i.throw(t))}catch(t){o(t)}}function step(t){t.done?s(t.value):new a(function(e){e(t.value)}).then(fulfilled,rejected)}step((i=i.apply(t,e||[])).next())})}class a{static getString(t,e=""){let a=Laya.LocalStorage.getItem(t);return a||(a=e),a}static setString(t,e){Laya.LocalStorage.setItem(t,e)}static getJson(t,e=null){let a=this.getString(t,JSON.stringify(e));return JSON.parse(a)}static setJson(t,e){this.setString(t,JSON.stringify(e))}static getInt(t,e=0){let a=this.getString(t,e+""),i=parseInt(a);return isNaN(i)&&(i=e),i}static setInt(t,e){this.setString(t,e+"")}static getFloat(t,e=0){let a=this.getString(t,e+""),i=parseFloat(a);return isNaN(i)&&(i=e),i}static setFloat(t,e){this.setString(t,e+"")}static getBoolean(t,e=!1){return 0!==this.getInt(t,e?1:0)}static setBoolean(t,e){this.setInt(t,e?1:0)}}!function(t){t[t.high=2]="high",t[t.middle=1]="middle",t[t.low=0]="low"}(e||(e={}));class i{constructor(){if(this.rate=1,this.Level=e.high,Laya.Browser.onMiniGame){if(this.SysInfo=wx.getSystemInfoSync(),console.log("SysInfo",this.SysInfo),Laya.Browser.onAndroid){let t=this.SysInfo.benchmarkLevel||0;this.Level=t}else if(Laya.Browser.onIOS||Laya.Browser.onIPhone){let t=this.SysInfo.model||"",a=(t=t.toLowerCase()).match(/^iphone (\d*|x|xr|se)/);if(!a||0===a.length)return;let i=a[0].substring(7);if("x"===i||"xr"===i||"se"===i)this.Level=e.middle;else{let t=parseInt(i);this.Level=t>=13?e.high:t>=10?e.middle:e.low}}}else this.SysInfo={model:"",windowWidth:Laya.Browser.width,windowHeight:Laya.Browser.height,statusBarHeight:0,benchmarkLevel:-1,platform:"devtools",safeArea:{left:0,right:Laya.Browser.width-0,top:0,bottom:Laya.Browser.height-0,width:Laya.Browser.width,height:Laya.Browser.height},deviceOrientation:Laya.Browser.height>Laya.Browser.width?"portrait":"landscape"},this.Level=e.high;Laya.stage.height>Laya.stage.width?this.rate=Laya.stage.width/this.SysInfo.windowWidth:this.rate=Laya.stage.height/this.SysInfo.windowHeight,i._isVibrate=a.getBoolean("isVibrate",!0)}static get isVibrate(){return this._isVibrate}static set isVibrate(t){this._isVibrate=t,a.setBoolean("isVibrate",t)}static vibrateShort(t="medium"){this._isVibrate&&Laya.Browser.onMiniGame&&wx.vibrateShort({type:t})}static vibrateLong(){this._isVibrate&&Laya.Browser.onMiniGame&&wx.vibrateLong({})}static get isLongScreen(){return Laya.Browser.clientHeight/Laya.Browser.clientWidth>2}static get I(){return this._I||(this._I=new i),this._I}get statusBarHeight(){return this.SysInfo.statusBarHeight*this.rate}static get safeArea(){return{left:i.I.SysInfo.safeArea.left*i.I.rate,right:i.I.SysInfo.safeArea.right*i.I.rate,top:i.I.SysInfo.safeArea.top*i.I.rate,bottom:i.I.SysInfo.safeArea.bottom*i.I.rate,width:i.I.SysInfo.safeArea.width*i.I.rate,height:i.I.SysInfo.safeArea.height*i.I.rate}}}i._isVibrate=!0,i._I=null;class s{constructor(){this.muted=a.getBoolean("muted",!1),this.musicMuted=a.getBoolean("musicMuted",!1),this.soundMuted=a.getBoolean("soundMuted",!1)}static get I(){return this._I||(this._I=new this)}get muted(){return Laya.SoundManager.muted}set muted(t){Laya.SoundManager.muted=t,a.setBoolean("muted",t)}get musicMuted(){return Laya.SoundManager.musicMuted}set musicMuted(t){Laya.SoundManager.musicMuted=t,a.setBoolean("musicMuted",t)}get soundMuted(){return Laya.SoundManager.soundMuted}set soundMuted(t){Laya.SoundManager.soundMuted=t,a.setBoolean("soundMuted",t)}get musicVolume(){return Laya.SoundManager.musicVolume}set musicVolume(t){Laya.SoundManager.setMusicVolume(t)}get soundVolume(){return Laya.SoundManager.soundVolume}set soundVolume(t){Laya.SoundManager.setSoundVolume(t)}playMusic(t,e=!0){return Laya.SoundManager.playMusic(t,e?0:1)}stopMusic(){Laya.SoundManager.stopMusic()}playSound(t,e=!1,a=null){let i=Laya.SoundManager.playSound(t,e?0:1);return i&&(i.volume=null===a?this.soundVolume:a),i}stopSound(t){Laya.SoundManager.stopSound(t)}stopAll(){Laya.SoundManager.stopAll()}}s._I=null;class o{static getWeek(t=new Date){let e=t,a=e.getDay()||7;e.setDate(e.getDate()-a+1+5);let i=new Date(e.getFullYear(),0,1),s=i.getDay(),o=1;0!=s&&(o=7-s+1),i=new Date(e.getFullYear(),0,1+o);let n=Math.ceil((e.valueOf()-i.valueOf())/864e5);return Math.ceil(n/7)+1}static getTime(t=new Date){return t.getTime()}static getSecond(t=new Date){return Math.floor(t.getTime()/1e3)}static format(t="yyyy-mm-dd",e=new Date){var a={"m+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"i+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var i in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[i]:("00"+a[i]).substr((""+a[i]).length)));return t}static secondFormat(t,e="hh:ii:ss"){let a=(t=Math.round(t))%60,i=Math.floor(t/60),s=[];if(new RegExp("(h+)").test(e)){let t=Math.floor(i/60);i%=60,s.push({key:"h+",val:t})}return s.push({key:"s+",val:a}),s.push({key:"i+",val:i}),s.forEach(t=>{new RegExp("("+t.key+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t.val+"":("00"+t.val).substr((""+t.val).length)))}),e}}class n{static init(){return __awaiter(this,void 0,void 0,function*(){Laya.timer.loop(1e3,this,n.onUpdate,[1]),yield wxsdk.InitSdk(l.appid,l.version),this.initShare(),this.initGameClub(),this.nickName=a.getString("nickName",""),this.avatarUrl=a.getString("avatarUrl",""),Laya.Browser.onMiniGame&&wx.onHide(()=>{a.setString("nickName",this.nickName),a.setString("avatarUrl",this.avatarUrl)})})}static onUpdate(t=1){return __awaiter(this,void 0,void 0,function*(){})}static getValue(t){let e=wxsdk.GetConfigById(t);return e||void 0===l.value[t]?e:l.value[t]}static log(...t){l.isLog&&console.log("[umsdk]",...t)}static event(t,e=null){t&&Laya.Browser.onMiniGame&&(wx.reportEvent(t.toLowerCase(),e),this.log(t,e))}static initShare(){Laya.Browser.onMiniGame&&(wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]}),wx.onShareTimeline(()=>(x.event(t.AddTask,"share"),r)),wx.onShareAppMessage(()=>(x.event(t.AddTask,"share"),r)),wx.onShareMessageToFriend(e=>{e.success&&x.event(t.AddTask,"share")}))}static share(){Laya.Browser.onMiniGame&&wx.shareAppMessage(r),x.event(t.AddTask,"share")}static getRank(t=1,e=99,a=7){return __awaiter(this,void 0,void 0,function*(){let i=new Date,s=o.format("yyyy-mm-dd",new Date(i.getTime()-24*a*3600*1e3)),n=o.format("yyyy-mm-dd",i),r=yield wxsdk.GetRankList(t,e,s,n,s,n),l={val:this._rankMap[t]||0,nickName:this.nickName,avatarUrl:this.avatarUrl,uid:this.uid,index:-1};for(r=r.map(t=>{let e=JSON.parse(t.extra_data),a=t.uid,i=a===l.uid;return{val:i?l.val:t.score,nickName:i?l.nickName:e.nickName,avatarUrl:i?l.avatarUrl:e.avatarUrl,uid:a,isSelf:i}});r.length<e;)r.push({val:Math.round(1e3*Math.random()),nickName:"",avatarUrl:"",uid:"000000"+Math.round(1e6*Math.random()),isSelf:!1});return r=r.sort((t,e)=>e.val-t.val),l.index=r.findIndex(t=>t.isSelf),{list:r,self:l}})}static setRank(t,e=1){this._rankMap[e]=t,wxsdk.SetRank(e,t,{nickName:this.nickName,avatarUrl:this.avatarUrl})}static get uid(){return wxsdk.umsdk.data?wxsdk.umsdk.data.uid:0}static initGameClub(){if(Laya.Browser.onMiniGame){let t=wx.getSystemInfoSync().screenWidth/Laya.stage.width,e={width:94,height:85},a=60*t,s=a/e.height*e.width,o={type:"image",image:"loadui/gameclub.png",style:{left:490*t,top:(i.safeArea.top+22+7)*t,width:s,height:a}},n=this.getValue("GameClubOpenLink");n&&(o.openlink=n),this.gameClubButton=wx.createGameClubButton(o),console.log(this.gameClubButton),this.gameClubButton.hide(),this.gameClubButton.onTap(()=>{console.log("打开游戏圈")})}}static showGameClubButton(){this.gameClubButton&&this.gameClubButton.show()}static hideGameClubButton(){this.gameClubButton&&this.gameClubButton.hide()}static getGift(){return __awaiter(this,void 0,void 0,function*(){return yield wxsdk.umsdk.getGift()})}static showVideo(t=null,e=null){return __awaiter(this,void 0,void 0,function*(){if(!Laya.Browser.onMiniGame)return!0;return"Success"==(yield this.playAd("Video"))})}static playAd(t){return __awaiter(this,void 0,void 0,function*(){if(Laya.Browser.onMiniGame)return this.log("playAd",t),yield wxsdk.GetAdById(t)})}static authorize(t="scope.WxFriendInteraction"){return __awaiter(this,void 0,void 0,function*(){return!Laya.Browser.onMiniGame||new Promise((e,a)=>{wx.getSetting({success:a=>{console.log("获取授权",a),a.authSetting[t]?e(!0):wx.authorize({scope:t,success:()=>{e(!0)},fail:()=>{e(!1)}})}})})})}static openSetting(t){return __awaiter(this,void 0,void 0,function*(){return!Laya.Browser.onMiniGame||new Promise((e,a)=>{wx.openSetting({success:a=>{e(!!a.authSetting[t])}})})})}}n._rankMap={1:0},n.nickName="",n.avatarUrl="",n.gameClubButton=null;const r={title:"快来把货柜物品全部消除",imageUrlId:"x9lRAElkRFKWS7K/WWBK3g==",imageUrl:"https://mmocgame.qpic.cn/wechatgame/1zyoYZSy6vgvXAABWhw1GQlcKdk6GgiacHemx60qO0AL9fw2iaS29JZRFWZiccAukcw/0"},l={appid:10489,version:"1.3.2",isLog:!0,value:{VideoIconStatus:0,ToolVideo:0,ToolTimeDuration:60,ToolFreezeDuration:30,ToolLocation:0}};class h{static request(t,e="",a="get",i="json"){return __awaiter(this,void 0,void 0,function*(){return new Promise((s,o)=>{var n=new Laya.HttpRequest;n.http.timeout=1e4,n.once(Laya.Event.COMPLETE,this,t=>{console.log("请求成功",t),s(t)}),n.once(Laya.Event.ERROR,this,t=>{console.log("请求错误",t),s(null)}),n.send(t,e,a,i)})})}}class d{static load(t,e=null,a=!1){return __awaiter(this,void 0,void 0,function*(){return new Promise((i,s)=>{Laya.loader.load(t,Laya.Handler.create(this,t=>{i(t)}),null,e,0,!0,"",a)})})}static create(t){return __awaiter(this,void 0,void 0,function*(){return new Promise((e,a)=>{Laya.loader.create(t,Laya.Handler.create(this,t=>{e(t)}))})})}static loadSubpackage(t){return __awaiter(this,void 0,void 0,function*(){return!Laya.Browser.onMiniGame||new Promise((e,a)=>{wx.loadSubpackage({name:t,success:t=>{e(!0)},fail:t=>{e(!1)}})})})}}class c{constructor(){this.prefix="https://aliyun.umgame.cn/game-assets/minigamepackage/main/",this.suffix=".json",this.timeout=864e5,this.map={},this.map=a.getJson("ConfigCacheMap",{})}static get I(){return this._I||(this._I=new this)}get appid(){return l.appid}get version(){return l.version}upload(){a.setJson("ConfigCacheMap",this.map)}get(t){return __awaiter(this,void 0,void 0,function*(){let e,i=o.getTime();return"number"==typeof this.map[t]&&this.map[t]>i&&(e=a.getJson(`ConfigCache_${t}`))?e:((e=yield h.request(`${this.prefix}${l.appid}/${l.version}/${t}${this.suffix}`))||(e=yield h.request(`${this.prefix}${l.appid}/default/${t}${this.suffix}`)),e||(e=yield d.load(`config/${t}${this.suffix}`)),e&&(this.map[t]=i+this.timeout,a.setJson(`ConfigCache_${t}`,e),this.upload()),e)})}}c._I=null;class u{constructor(){}static get I(){return this._I||(this._I=new this)}open(t,e=!0,a={},i=null){return __awaiter(this,void 0,void 0,function*(){this.has||x.event("OpenFirstDialog");let s=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));yield n.playAd(s+"_Open"),n.playAd(s+"_Enable"),n.event(s+"_Open"),x.event("OpenDialog",s);let o=yield this._open(t,e,a,i);return yield n.playAd(s+"_Close"),n.event(s+"_Close"),x.event("CloseDialog",s),o})}_open(t,e=!0,a={},i=null){let s=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf("."));return new Promise((o,n)=>{Laya.Dialog.open(t,e,a,Laya.Handler.create(this,t=>{console.log(t),t.name=s,"function"==typeof t.onCreated&&t.onCreated(a);let e=t.getComponents(Laya.Script);if(e&&e.length)for(let t=0,i=e.length;t<i;t++)"function"==typeof e[t].onCreated&&e[t].onCreated(a);t.once(Laya.Event.REMOVED,this,()=>{i&&i.run(),this.has||x.event("CloseAllDialog"),o(t.closeReturnData||null)})}))})}close(t){Laya.Dialog.close(t),this.has||x.event("CloseAllDialog")}closeAll(){Laya.Dialog.closeAll(),x.event("CloseAllDialog")}get has(){for(let t of Laya.Dialog.manager._children)if(t instanceof Laya.Dialog)return!0;return!1}get root(){return Laya.Dialog.root}waitCloseAll(t=[]){return __awaiter(this,void 0,void 0,function*(){return new Promise((e,a)=>{let i=()=>{for(let e of Laya.Dialog.manager._children)if(e instanceof Laya.Dialog&&-1===t.indexOf(e.name))return;Laya.timer.clear(this,i),e()};Laya.timer.frameLoop(2,this,i)})})}}u._I=null;class g{static resetTransform(t){t&&!t.destroyed&&(t.transform.localPosition=new Laya.Vector3(0,0,0),t.transform.localRotationEuler=new Laya.Vector3(0,0,0),t.transform.localScale=new Laya.Vector3(1,1,1))}static removeChildren(t){if(t&&t.numChildren)for(let e=t.numChildren-1;e>=0;--e){t.getChildAt(e).destroy()}}static findPath(t,e){if(!e)return null;if("string"==typeof t)t=t.split("/");else if(0===t.length)return e;return t[t.length-1]||t.splice(t.length-1,1),0===t.length?e:this._findPath(t,e._children)}static _findPath(t,e){if(0===t.length)return e[0]||null;if(1===t.length){let a=t[0];for(let t=0,i=e.length;t<i;t++)if(e[t].name===a)return e[t];return null}{let a=[],i=t[0];for(let t=0,s=e.length;t<s;t++)e[t].name===i&&(a=a.concat(e[t]._children));return a.length?this._findPath(t.slice(1),a):null}}static findChild(t,e){return e?this.checkNodeName(t,e.name)?e:this._findChild(t,e._children):null}static _findChild(t,e){for(var a=[],i=0;i<e.length;i++){var s=e[i];if(this.checkNodeName(t,s.name))return s;s.numChildren&&(a=a.concat(s._children))}return a.length?this._findChild(t,a):null}static checkNodeName(t,e){return t instanceof RegExp?t.test(e):t===e}static getComponentsInChildren(t,e){if(!e)return[];let a=[],i=e=>{if(!e)return null;let s=e._components;if(s)for(let e=0;e<s.length;e++){let i=s[e];i instanceof t&&a.push(i)}for(let t=0;t<e.numChildren;t++)i(e.getChildAt(t)),0};return i(e),a}static createMesh(t,e,a){let i=Laya.LayaGL.instance,s=new Laya.Mesh,o=new Laya.VertexBuffer3D(4*e.length,i.STATIC_DRAW,!0);o.vertexDeclaration=t,o.setData(e.buffer),s._vertexBuffer=o,s._vertexCount=o._byteLength/t.vertexStride;let n=new Laya.IndexBuffer3D(Laya.IndexFormat.UInt16,a.length,i.STATIC_DRAW,!0);n.setData(a),s._indexBuffer=n,s._setBuffer(o,n),s._setInstanceBuffer(s._instanceBufferStateType);let r=new Laya.SubMesh(s);r._vertexBuffer=o,r._indexBuffer=n,r._setIndexRange(0,n.indexCount);let l=r._subIndexBufferStart,h=r._subIndexBufferCount,d=r._boneIndicesList;l.length=1,h.length=1,d.length=1,l[0]=0,h[0]=n.indexCount;let c=[];c.push(r),s._setSubMeshes(c),s.calculateBounds();let u=o._byteLength+n._byteLength;return s._setCPUMemory(u),s._setGPUMemory(u),s}static createShapeLine(t,e){let a=[],i=e.split(",").map(t=>parseFloat(t));for(let t=0,e=i.length;t<e;t+=2)a.push(new Laya.Vector3(i[t],i[t+1]));a.map(t=>(t.x/=1,t.y/=1,t));let s=0,o=0;for(let t of a)t.x>o?o=t.x:t.x<s&&(s=t.x);let n=a.length,r=o-s,l=0,h=Laya.VertexMesh.getVertexDeclaration("POSITION,NORMAL,UV"),d=[],c=[];for(let e=0,i=t.length;e<i;e++){let s,o=t[e].position,h=t[e].normal;if(e+1>=i){let a=new Laya.Vector3;Laya.Vector3.subtract(o,t[e-1].position,a),s=new Laya.Vector3,Laya.Vector3.add(o,a,s)}else s=t[e+1].position;let u=new Laya.Vector3;Laya.Vector3.subtract(s,o,u);let g=new Laya.Vector3;Laya.Vector3.cross(u,h,g),Laya.Vector3.normalize(g,g);for(let t=0;t<n;t++){let e=a[t];Laya.Vector3.scale(g,e.x,this._v3_0),Laya.Vector3.scale(h,e.y,this._v3_1),Laya.Vector3.add(o,this._v3_0,this._v3_2),Laya.Vector3.add(this._v3_2,this._v3_1,this._v3_3),d.push(this._v3_3.x,this._v3_3.y,this._v3_3.z,h.x,h.y,h.z,e.x/r+.5,l/r)}if(e!=i-1){l+=Laya.Vector3.distance(s,o);for(let t=n*e;t<n*(e+1)-1;t++)c.push(t,t+1,t+n),c.push(t+1,t+n+1,t+n)}}return this.createMesh(h,new Float32Array(d),new Uint16Array(c))}static hexToRGBA(t,e=1){t=t.replace("#","");const a=parseInt(t.slice(0,2),16)/255,i=parseInt(t.slice(2,4),16)/255,s=parseInt(t.slice(4,6),16)/255;return new Laya.Vector4(a,i,s,e)}static worldToScreen(t,e){const a=new Laya.Vector4;return e.worldToViewportPoint(t,a),new Laya.Vector2(a.x,a.y)}}g._v3_0=new Laya.Vector3,g._v3_1=new Laya.Vector3,g._v3_2=new Laya.Vector3,g._v3_3=new Laya.Vector3,g._quaternion_0=new Laya.Quaternion,g._quaternion_1=new Laya.Quaternion,g._quaternion_2=new Laya.Quaternion,g._quaternion_3=new Laya.Quaternion;class m{constructor(){this.status=!1,this.preAppIsPause=!0,this.scale=1,this.root=null,this.hitArea=null,this.interactionArea=null,this.handUpSkin="",this.handDownSkin="",this.updateFrameIndex=0,this.updateFrameLength=40,this.steps=[],this.stepIndex=0,this.completeCallback=null,this.progressCallback=null}static get I(){return this._I||(this._I=new m),m._I}init(t={}){t.handUpSkin&&(this.handUpSkin=t.handUpSkin),t.handDownSkin&&(this.handDownSkin=t.handDownSkin),this.root=Laya.stage.addChild(new Laya.Box),this.root.name="Guide",this.root.zOrder=2e3,this.root.width=Laya.stage.width/this.scale,this.root.height=Laya.stage.height/this.scale;let e=new Laya.Box;e.cacheAs="bitmap",this.root.addChild(e),this.maskArea=new Laya.Sprite,this.maskArea.alpha=.5,this.maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),e.addChild(this.maskArea),this.interactionArea=new Laya.Sprite,this.interactionArea.blendMode="destination-out",e.addChild(this.interactionArea),this.hitArea=new Laya.HitArea,this.hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.root.hitArea=this.hitArea,this.root.mouseEnabled=!0,this.hitGuide=new Laya.Sprite,this.hitGuide.mouseEnabled=!1,this.root.addChild(this.hitGuide),this.tipsImg=this.root.addChild(new Laya.Image),this.tipsImg.name="TipsImg",this.tipsImg.visible=!1,this.tipsImg.anchorX=.5,this.tipsImg.anchorY=.5,this.tipsTxt=this.root.addChild(new Laya.Label),this.tipsTxt.name="tipsTxt",this.tipsTxt.visible=!1,this.tipsTxt.font="SimHei",this.tipsTxt.color="#ffffff",this.tipsTxt.italic=!1,this.tipsTxt.bold=!1,this.tipsTxt.fontSize=35,this.tipsTxt.anchorX=.5,this.tipsTxt.anchorY=.5,this.tipsTxt.valign="middle",this.tipsTxt.align="center",this.hand=this.root.addChild(new Laya.Image),this.hand.name="Hand",this.hand.visible=!1,this.root.visible=!1}onUpdate(){if(this.steps[this.stepIndex]&&this.steps[this.stepIndex].hitArea){let t=this.steps[this.stepIndex],e=2-this.updateFrameIndex%this.updateFrameLength/20+1;this.hitGuide.graphics.clear(),"rect"===this.steps[this.stepIndex].hitAreaShape?this.hitGuide.graphics.drawRect(t.hitAreaX-t.hitAreaWidth*e/2,t.hitAreaY-t.hitAreaHeight*e/2,t.hitAreaWidth*e,t.hitAreaHeight*e,null,t.hitGuideLineColor,t.hitGuideLineWidth):this.hitGuide.graphics.drawCircle(t.hitAreaX,t.hitAreaY,t.hitAreaRadius*e,null,t.hitGuideLineColor,t.hitGuideLineWidth),this.updateFrameIndex++}}onStageClick(t){this.status&&(this.steps[this.stepIndex]?null===this.steps[this.stepIndex].condition&&(!this.steps[this.stepIndex].hitArea||"rect"===this.steps[this.stepIndex].hitAreaShape&&this.steps[this.stepIndex].hitAreaX-this.steps[this.stepIndex].hitAreaWidth/2<Laya.stage.mouseX&&this.steps[this.stepIndex].hitAreaX+this.steps[this.stepIndex].hitAreaWidth/2>Laya.stage.mouseX&&this.steps[this.stepIndex].hitAreaY-this.steps[this.stepIndex].hitAreaHeight/2<Laya.stage.mouseY&&this.steps[this.stepIndex].hitAreaY+this.steps[this.stepIndex].hitAreaHeight/2>Laya.stage.mouseY||"circular"===this.steps[this.stepIndex].hitAreaShape&&Math.pow(this.steps[this.stepIndex].hitAreaRadius,2)>Math.pow(Laya.stage.mouseX-this.steps[this.stepIndex].hitAreaX,2)+Math.pow(Laya.stage.mouseY-this.steps[this.stepIndex].hitAreaY,2))&&(this.steps[this.stepIndex].onEnd&&this.steps[this.stepIndex].onEnd.runWith([this.steps[this.stepIndex].name,(this.stepIndex+1)/this.steps.length]),++this.stepIndex<this.steps.length?(this.updateStep(),this.progressCallback&&this.progressCallback.runWith([this.steps[this.stepIndex-1].name,this.stepIndex/this.steps.length])):this.stop()):this.stop())}stop(){Laya.stage.off(Laya.Event.CLICK,this,this.onStageClick),this.status=!1,x.isPause=this.preAppIsPause,this.steps=[],this.root.visible=!1,Laya.timer.clear(this,this.onUpdate),this.completeCallback&&this.completeCallback.run()}play(t,e=null,a=null){return __awaiter(this,void 0,void 0,function*(){return new Promise((i,s)=>{this.preAppIsPause=x.isPause,t.map((t,e)=>(t.name=t.name||`step_${e}`,t.isPause=void 0!==t.isPause&&t.isPause,t.shape=t.shape||"circular",t.isNode=!(!t.path&&!t.root),t.path=t.path||"",t.root=t.root||Laya.stage,t.condition=t.condition||null,t.onStart=t.onStart||null,t.onEnd=t.onEnd||null,void 0===t.mask&&(t.mask=!1),t.maskX=t.maskX/this.scale||0,t.maskY=t.maskY/this.scale||0,t.maskShape=t.maskShape||"circular","circular"===t.maskShape?t.maskRadius=(t.maskRadius||50)/this.scale:(t.maskWidth=(t.maskWidth||100)/this.scale,t.maskHeight=(t.maskHeight||100)/this.scale),void 0===t.hitArea&&(t.hitArea=!0),t.hitAreaX=t.hitAreaX/this.scale||0,t.hitAreaY=t.hitAreaY/this.scale||0,t.hitAreaShape=t.hitAreaShape||"circular","circular"===t.hitAreaShape?t.hitAreaRadius=(t.hitAreaRadius||50)/this.scale:(t.hitAreaWidth=(t.hitAreaWidth||100)/this.scale,t.hitAreaHeight=(t.hitAreaHeight||100)/this.scale),t.hitGuideLineColor=t.hitGuideLineColor||"#ffffff",t.hitGuideLineWidth="number"==typeof t.hitGuideLineWidth?t.hitGuideLineWidth:5,t.tipsTxtX=t.tipsTxtX/this.scale||0,t.tipsTxtY=t.tipsTxtY/this.scale||0,t.tipsTxtWidth="number"==typeof t.tipsTxtWidth?t.tipsTxtWidth/this.scale:null,t.tipsTxtHeight="number"==typeof t.tipsTxtHeight?t.tipsTxtHeight/this.scale:null,t.tipsTxtFont="string"==typeof t.tipsTxtFont?t.tipsTxtFont:"SimHei",t.tipsTxtColor="string"==typeof t.tipsTxtColor?t.tipsTxtColor:"#ffffff",t.tipsTxtItalic="boolean"==typeof t.tipsTxtItalic&&t.tipsTxtItalic,t.tipsTxtBold="boolean"==typeof t.tipsTxtBold&&t.tipsTxtBold,t.tipsTxtFontSize="number"==typeof t.tipsTxtFontSize?t.tipsTxtFontSize:35,t.tipsTxtBgColor="string"==typeof t.tipsTxtBgColor?t.tipsTxtBgColor:"",t.tipsTxtPadding="string"==typeof t.tipsTxtPadding?t.tipsTxtPadding:"",t.tipsTxtBgColor=t.tipsTxtBgColor||"",t.tipsTxtPadding=t.tipsTxtPadding||"",t.tipsImgX=t.tipsImgX/this.scale||0,t.tipsImgY=t.tipsImgY/this.scale||0,t.tipsImgWidth=(t.tipsImgWidth||0)/this.scale,t.tipsImgHeight=(t.tipsImgHeight||0)/this.scale,t.tipsImgSizeGrid="string"==typeof t.tipsImgSizeGrid?t.tipsImgSizeGrid:"",t.handX=t.handX/this.scale||0,t.handY=t.handY/this.scale||0,t.handToX=t.handToX/this.scale||0,t.handToY=t.handToY/this.scale||0,t)),this.steps=[],this.steps=t,this.stepIndex=0,this.completeCallback=new Laya.Handler(this,()=>{e&&e.run(),i()}),this.progressCallback=a,this.status=!0,this.updateStep(),this.root.visible=!0,Laya.stage.on(Laya.Event.CLICK,this,this.onStageClick),Laya.timer.frameLoop(2,this,this.onUpdate)})})}updateStep(){if(!this.steps[this.stepIndex])return;this.root.width=Laya.stage.width/this.scale,this.root.height=Laya.stage.height/this.scale,this.updateFrameIndex=0,this.hitGuide.graphics.clear();let t=this.steps[this.stepIndex];if(console.log("更新步骤",t),t.isNode){let e=t.path?g.findPath(t.path,t.root):t.root,a=e.localToGlobal(new Laya.Point(e.width/2,e.height/2),!1,Laya.stage),i=e.globalScaleX*e.width,s=e.globalScaleY*e.height;t.maskX=t.hitAreaX=t.handX=t.tipsTxtX=a.x,t.maskY=t.hitAreaY=t.handY=a.y,t.tipsTxtY=a.y-50,t.maskWidth=t.hitAreaWidth=i,t.maskHeight=t.hitAreaHeight=s,t.maskRadius=t.hitAreaRadius=Math.sqrt(i*i+s*s)/2,t.maskShape=t.hitAreaShape=t.shape}if(x.isPause=t.isPause,t.condition){let e=this,a=function(){t.condition.run()&&(Laya.timer.clear(e,a),t.onEnd&&t.onEnd.runWith([t.name,(e.stepIndex+1)/e.steps.length]),++e.stepIndex<e.steps.length?(e.updateStep(),e.progressCallback&&e.progressCallback.runWith([e.stepIndex/e.steps.length,e.steps[e.stepIndex-1].name])):(Laya.stage.off(Laya.Event.CLICK,e,e.onStageClick),e.status=!1,x.isPause=e.preAppIsPause,e.steps=[],e.root.visible=!1,Laya.timer.clear(this,this.onUpdate),e.completeCallback&&e.completeCallback.run()))};Laya.timer.frameLoop(10,e,a)}if(t.onStart&&t.onStart.runWith([t.name,(this.stepIndex+1)/this.steps.length]),this.interactionArea.graphics.clear(),this.hitArea.unHit.clear(),t.mask)switch(this.maskArea.visible=!0,this.maskArea.graphics.clear(),this.maskArea.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.steps[this.stepIndex].maskShape){case"circular":{let e={maskRadius:750};Laya.Tween.to(e,{maskRadius:t.maskRadius,update:new Laya.Handler(this,()=>{this.interactionArea.graphics.clear(),this.interactionArea.graphics.drawCircle(t.maskX,t.maskY,e.maskRadius,"#ffffff")})},300,Laya.Ease.circOut),this.hitArea.unHit.drawCircle(t.maskX,t.maskY,t.maskRadius,"#ffffff");break}case"rect":{let e={maskWidth:Laya.stage.width,maskHeight:Laya.stage.height};Laya.Tween.to(e,{maskWidth:t.maskWidth,maskHeight:t.maskHeight,update:new Laya.Handler(this,()=>{this.interactionArea.graphics.clear(),this.interactionArea.graphics.drawRect(t.maskX-e.maskWidth/2,t.maskY-e.maskHeight/2,e.maskWidth,e.maskHeight,"#ffffff")})},300,Laya.Ease.circOut),this.hitArea.unHit.drawRect(t.maskX-t.maskWidth/2,t.maskY-t.maskHeight/2,t.maskWidth,t.maskHeight,"#ffffff");break}}else this.maskArea.visible=!1,this.hitArea.unHit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#ffffff");if(this.hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#ffffff"),this.hitArea.unHit.clear(),t.hitArea)switch(this.steps[this.stepIndex].hitAreaShape){case"circular":this.hitArea.unHit.drawCircle(t.hitAreaX,t.hitAreaY,t.hitAreaRadius,"#ffffff");break;case"rect":this.hitArea.unHit.drawRect(t.hitAreaX-t.hitAreaWidth/2,t.hitAreaY-t.hitAreaHeight/2,t.hitAreaWidth,t.hitAreaHeight,"#ffffff")}else this.hitArea.unHit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#ffffff");if(t.tipsTxt?(this.tipsTxt.visible=!0,this.tipsTxt.text=t.tipsTxt,this.tipsTxt.x=t.tipsTxtX,this.tipsTxt.y=t.tipsTxtY,this.tipsTxt.color=t.tipsTxtColor,this.tipsTxt.italic=t.tipsTxtItalic,this.tipsTxt.bold=t.tipsTxtBold,this.tipsTxt.font=t.tipsTxtFont,this.tipsTxt.fontSize=t.tipsTxtFontSize,this.tipsTxt.bgColor=t.tipsTxtBgColor,this.tipsTxt.padding=t.tipsTxtPadding,this.tipsTxt.width=t.tipsTxtWidth,this.tipsTxt.height=t.tipsTxtHeight):this.tipsTxt.visible=!1,t.tipsImg?(console.log(">>>>>>>>>>>>>>>>",t.tipsImg),this.tipsImg.skin=t.tipsImg,this.tipsImg.visible=!0,this.tipsImg.x=t.tipsImgX,this.tipsImg.y=t.tipsImgY,this.tipsImg.width=t.tipsImgWidth,this.tipsImg.height=t.tipsImgHeight,this.tipsImg.sizeGrid=t.tipsImgSizeGrid):this.tipsImg.visible=!1,t.hand)switch(this.handTimeLine&&this.handTimeLine.total&&this.handTimeLine.destroy(),t.hand){case"click":this.hand.visible=!0,this.hand.pos(t.handX,t.handY),this.hand.skin=this.handUpSkin,this.handTimeLine=new Laya.TimeLine,this.handTimeLine.to(this.hand,{scaleX:.8,scaleY:.8},300).to(this.hand,{scaleX:1,scaleY:1},300),this.handTimeLine.play(0,!0);break;case"drag":this.hand.visible=!0,this.hand.pos(t.handX,t.handY),this.hand.skin=this.handUpSkin,this.handTimeLine=new Laya.TimeLine,this.handTimeLine.to(this.hand,{x:t.handX,y:t.handY},0).to(this.hand,{scaleX:.8,scaleY:.8},100).to(this.hand,{x:t.handToX,y:t.handToY},1e3).to(this.hand,{scaleX:1,scaleY:1},100),this.handTimeLine.play(0,!0);break;case"press":this.hand.visible=!0,this.hand.pos(t.handX,t.handY),this.hand.skin=this.handUpSkin,this.handTimeLine=new Laya.TimeLine,this.handTimeLine.to(this.hand,{scaleX:1,scaleY:1},0).to(this.hand,{scaleX:.8,scaleY:.8},200).to(this.hand,{scaleX:1,scaleY:1},200,null,2e3),this.handTimeLine.play(0,!0);break;default:this.hand.visible=!1,this.handTimeLine&&this.handTimeLine.destroy()}}}class p{constructor(){}static get I(){return this._I||(this._I=new this)}init(){return __awaiter(this,void 0,void 0,function*(){})}}p._I=null;class f{static sleep(t=1e3){return __awaiter(this,void 0,void 0,function*(){return new Promise((e,a)=>{Laya.timer.once(t,this,e)})})}static frameSleep(t=1){return __awaiter(this,void 0,void 0,function*(){return new Promise((e,a)=>{Laya.timer.frameOnce(t,this,e)})})}static date_getTime(t=new Date){return t.getTime()}static date_getSecond(t=new Date){return t.getTime()/1e3}static date_secondFormat(t,e="hh:ii:ss"){let a=(t=Math.round(t))%60,i=Math.floor(t/60),s=[];if(new RegExp("(h+)").test(e)){let t=Math.floor(i/60);i%=60,s.push({key:"h+",val:t})}return s.push({key:"s+",val:a}),s.push({key:"i+",val:i}),s.forEach(t=>{new RegExp("("+t.key+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t.val+"":("00"+t.val).substr((""+t.val).length)))}),e}static date_format(t="yyyy-mm-dd",e=new Date){var a={"m+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"i+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var i in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?a[i]:("00"+a[i]).substr((""+a[i]).length)));return t}}class y{static scale(t,e=1,a=1.1,i=1,s=100,o=200){return __awaiter(this,void 0,void 0,function*(){if(t instanceof Laya.Sprite3D){t.transform.localScale=new Laya.Vector3(e,e,e);let n=new Laya.Vector3(a,a,a),r=new Laya.Vector3(i,i,i);yield this.to(t,{localScale:n},s),yield this.to(t,{endScale:r},o)}else t.scaleX=t.scaleY=e,yield this.to(t,{scaleX:a,scaleY:a},s),yield this.to(t,{scaleX:i,scaleY:i},o)})}static shake(t,e=10,a=800){return __awaiter(this,void 0,void 0,function*(){let i=t.rotation,s=a/8;yield this.to(t,{rotation:i-e},1*s),yield this.to(t,{rotation:i+e},2*s),yield this.to(t,{rotation:i-e},2*s),yield this.to(t,{rotation:i+e},2*s),yield this.to(t,{rotation:i+0},1*s)})}static jelly(t,e=800){return __awaiter(this,void 0,void 0,function*(){if(t instanceof Laya.Sprite3D){let a=t.transform.localScaleX,i=t.transform.localScaleY,s=t.transform.localScaleZ;yield this.line([{target:t.transform,props:{localScaleX:1.1*a,localScaleZ:1.1*s,localScaleY:.9*i},duration:1/8*e},{target:t.transform,props:{localScaleX:.9*a,localScaleZ:.9*s,localScaleY:1.1*i},duration:.25*e},{target:t.transform,props:{localScaleX:1.05*a,localScaleZ:1.05*s,localScaleY:.95*i},duration:.25*e},{target:t.transform,props:{localScaleX:.95*a,localScaleZ:.95*s,localScaleY:1.05*i},duration:.25*e},{target:t.transform,props:{localScaleX:1*a,localScaleZ:1*s,localScaleY:1*i},duration:1/8*e}])}else{let a=t.scaleX,i=t.scaleY;yield this.line([{target:t,props:{scaleX:1.1*a,scaleY:.9*i},duration:1/8*e},{target:t,props:{scaleX:.9*a,scaleY:1.1*i},duration:.25*e},{target:t,props:{scaleX:1.05*a,scaleY:.95*i},duration:.25*e},{target:t,props:{scaleX:.95*a,scaleY:1.05*i},duration:.25*e},{target:t,props:{scaleX:1*a,scaleY:1*i},duration:1/8*e}])}})}static paraCurve(t,e,a,i=2){return __awaiter(this,void 0,void 0,function*(){if(t instanceof Laya.Sprite3D){let s,o="";void 0!==e.localPosition?(o="localPosition",s=e.localPosition,delete e.localPosition,void 0!==e.position&&delete e.position):void 0!==e.position&&(o="position",s=e.position,delete e.position),Object.keys(e).length>0&&this.to(t,e,a);let n=new Laya.Vector3;Laya.Vector3.lerp(t.transform[o],s,.5,n),n.y+=i;let r=t.transform[o].clone();this.to(r,{x:s.x,z:s.z,update:new Laya.Handler(this,()=>{t&&t.transform&&t.transform[o]&&(r.cloneTo(t.transform[o]),t.transform[o]=t.transform[o])})},a,Laya.Ease.linearNone),yield this.to(r,{y:n.y},a/2,Laya.Ease.circOut),yield this.to(r,{y:s.y},a/2,Laya.Ease.circIn)}else{let s=(t.y+e.y)/2+i;y.to(t,{x:e.x},a,Laya.Ease.linearNone),yield y.to(t,{y:s},a/2,Laya.Ease.circOut),yield y.to(t,{y:e.y},a/2,Laya.Ease.circIn)}})}static to(t,e,a,i=null){return __awaiter(this,void 0,void 0,function*(){return new Promise((s,o)=>{t instanceof Laya.Sprite3D&&(e.position&&(Laya.Tween.to(t.transform.position,{x:e.position.x,y:e.position.y,z:e.position.z,update:new Laya.Handler(this,()=>{t&&t.transform&&t.transform.position&&(t.transform.position=t.transform.position)})},a,i),delete e.position),e.rotation&&(Laya.Tween.to(t.transform.rotation,{x:e.rotation.x,y:e.rotation.y,z:e.rotation.z,w:e.rotation.w,update:new Laya.Handler(this,()=>{t&&t.transform&&t.transform.rotation&&(t.transform.rotation=t.transform.rotation)})},a,i),delete e.rotation),e.localRotation&&(Laya.Tween.to(t.transform.localRotation,{x:e.localRotation.x,y:e.localRotation.y,z:e.localRotation.z,w:e.localRotation.w,update:new Laya.Handler(this,()=>{t&&t.transform&&t.transform.localRotation&&(t.transform.localRotation=t.transform.localRotation)})},a,i),delete e.localRotation),e.rotationEuler&&(Laya.Tween.to(t.transform.rotationEuler,{x:e.rotationEuler.x,y:e.rotationEuler.y,z:e.rotationEuler.z,update:new Laya.Handler(this,()=>{t&&t.transform&&t.transform.rotationEuler&&(t.transform.rotationEuler=t.transform.rotationEuler)})},a,i),delete e.rotationEuler),e.localPosition&&(Laya.Tween.to(t.transform.localPosition,{x:e.localPosition.x,y:e.localPosition.y,z:e.localPosition.z,update:new Laya.Handler(this,()=>{t&&t.transform&&t.transform.localPosition&&(t.transform.localPosition=t.transform.localPosition)})},a,i),delete e.localPosition),e.localRotationEuler&&(Laya.Tween.to(t.transform.localRotationEuler,{x:e.localRotationEuler.x,y:e.localRotationEuler.y,z:e.localRotationEuler.z,update:new Laya.Handler(this,()=>{t&&t.transform&&t.transform.localRotationEuler&&(t.transform.localRotationEuler=t.transform.localRotationEuler)})},a,i),delete e.localRotationEuler),e.scale&&(Laya.Tween.to(t.transform.localScale,{x:e.scale.x,y:e.scale.y,z:e.scale.z,update:new Laya.Handler(this,()=>{t&&t.transform&&t.transform.localScale&&(t.transform.localScale=t.transform.localScale)})},a,i),delete e.scale),e.localScale&&(Laya.Tween.to(t.transform.localScale,{x:e.localScale.x,y:e.localScale.y,z:e.localScale.z,update:new Laya.Handler(this,()=>{t&&t.transform&&t.transform.localScale&&(t.transform.localScale=t.transform.localScale)})},a,i),delete e.localScale)),0===Object.keys(e).length?Laya.timer.once(a,this,s):t&&!t.destroyed&&Laya.Tween.to(t,e,a,i,Laya.Handler.create(this,s))})})}static line(t){return __awaiter(this,void 0,void 0,function*(){for(let e of t)yield this.to(e.target,e.props,e.duration,e.ease||null)})}static clear(t){Laya.Tween.clearAll(t),t instanceof Laya.Sprite3D&&Laya.Tween.clearAll(t.transform)}}class w{constructor(){this.loadingSp=null,this.owner=Laya.stage}static get I(){return this._I||(this._I=new this)}msg(t,e=1500){return __awaiter(this,void 0,void 0,function*(){if(Laya.Browser.onMiniGame)wx.showToast({title:t,icon:"none",duration:e});else{let a=new Laya.Label(t);a.font="SimHei",a.color="#ffffff",a.fontSize=30,a.bgColor="rgba(0,0,0,0.5)",a.anchorX=a.anchorY=.5,a.padding="15,15,15,15",a.x=Laya.stage.width/2,a.y=Laya.stage.height/2,this.owner.addChild(a),a.scale(0,0),a.zOrder=2001,yield y.to(a,{scaleX:1,scaleY:1},100),yield f.sleep(e),yield y.to(a,{scaleX:0,scaleY:0},100),a.removeSelf()}})}confirm(t,e={},a=null,i=null){return __awaiter(this,void 0,void 0,function*(){return new Promise((s,o)=>{let n=this.owner.addChild(new Laya.Box);n.name="Confirm";let r=n.addChild(new Laya.Sprite),l=n.addChild(new Laya.Label),h=n.addChild(new Laya.Label),d=n.addChild(new Laya.Label),c=n.addChild(new Laya.Label);h.dataSource=d.dataSource=c.dataSource=l.dataSource={padding:"20,20,20,20",font:"SimHei",fontSize:30,width:.6*Laya.stage.width,color:"#000000",align:"center",x:0,y:0,text:"提示",overflow:"hidden"},l.dataSource={padding:"20,20,40,20",overflow:"",fontSize:25,wordWrap:!0,text:t,color:"#5A5A5A",y:h.height},d.dataSource={text:e.cancelText||"否",width:h.width/2,y:h.height+l.height},c.dataSource={text:e.yesText||"是",width:h.width/2,color:"#169C24",y:h.height+l.height,x:h.width/2},n.dataSource={width:.6*Laya.stage.width,height:h.height+l.height+c.height,x:.2*Laya.stage.width,y:(Laya.stage.height-h.height-l.height-c.height)/2},r.graphics.drawPath(0,0,function(t,e,a,i,s){return[["moveTo",t+s,0],["lineTo",t+a-s,0],["arcTo",t+a,e,t+a,e+s,s],["lineTo",t+a,e+i-s],["arcTo",t+a,e+i,t+a-s,e+i,s],["lineTo",t+s,e+i],["arcTo",t,e+i,t,e+i-s,s],["lineTo",t,e+s],["arcTo",t,e,t+s,e,s],["closePath"]]}(0,0,n.width,n.height,10),{fillStyle:"#FFFFFF"}),r.graphics.drawLine(0,h.height+l.height,n.width,h.height+l.height,"#D2D2D2",1),r.graphics.drawLine(n.width/2,h.height+l.height,n.width/2,n.height,"#D2D2D2",1),d.on(Laya.Event.CLICK,this,t=>{n.removeSelf(),i&&i(),s(!1)}),c.on(Laya.Event.CLICK,this,t=>{n.removeSelf(),a&&a(),s(!0)})})})}showLoading(){if(Laya.Browser.onMiniGame)wx.showLoading();else{if(this.loadingSp)return;let t=new Laya.Sprite;t.name="Loading";let e=100;Math.sin(.25*Math.PI),Math.cos(.25*Math.PI);for(let a=0,i=8;a<i;a++){let s=2*Math.PI/i*a,o=Math.sin(s)*e,n=Math.cos(s)*e;t.graphics.drawCircle(o,n,20,`rgba(255,255,255,${(a+1)/(i+1)})`)}this.owner.addChild(t),t.x=this.owner.width/2,t.y=this.owner.height/2,(new Laya.TimeLine).to(t,{rotation:-360},1e3).play(0,!0),this.loadingSp=t}}hideLoading(){Laya.Browser.onMiniGame?wx.hideLoading():this.loadingSp&&(this.loadingSp.removeSelf(),this.loadingSp=null)}}w._I=null;class _ extends Laya.Script{constructor(){super(),this.curUrl="",this.curName="",_.I=this}open(t){return __awaiter(this,void 0,void 0,function*(){yield this.close(),this.curUrl=t,this.curName=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")),yield n.playAd(this.curName+"_Open"),n.playAd(this.curName+"_Enable"),n.event(this.curName+"_Open");let e=yield d.load(t,Laya.Loader.PREFAB);if(!e)return;let a=e.create();a.name=this.curName,this.owner.addChild(a),x.event("OpenPage",this.curName)})}close(){return __awaiter(this,void 0,void 0,function*(){this.owner.removeChildren(),this.curName&&(yield n.playAd(this.curName+"_Close"),n.event(this.curName+"_Close"),x.event("ClosePage",this.curName),this.curName="")})}}_.I=null;const L=new Laya.Vector3(999,999,999);class b extends Laya.Script3D{constructor(){super(),this.map={}}onAwake(){b.I=this,this.owner.transform.position=new Laya.Vector3(-1e4,0,0),this.owner.active=!1}onDestroy(){b.I=null;for(let t=this.owner.numChildren-1;t>=0;t++){let e=this.owner.getChildAt(t);for(let t=e.numChildren-1;t>=0;t++){e.getChildAt(t).destroy()}e.destroy()}}getSign(t,e=!1){let a=this.owner.getChildByName(t);return a&&(a.removeSelf(),this.reset(a)),a}reset(t){t.transform.position=new Laya.Vector3(0,0,0),t.transform.rotation=new Laya.Quaternion}length(t){return this.getSign(t,!0).numChildren}get(t){let e=this.getSign(t,!0);if(0===e.numChildren)return;let a=e.getChildAt(0);return this.owner.scene.addChild(a),a}recover(){let t,e;if("string"==typeof arguments[0]&&arguments[1]instanceof Laya.Sprite3D?(t=arguments[0],e=arguments[1]):arguments[0]instanceof Laya.Sprite3D&&(t=(e=arguments[0]).sign||""),e)if(this.owner.addChild(e),e.active=!1,e.transform.position=L,t&&e){this.getSign(t,!0).addChild(e),g.resetTransform(e)}else if(e){let t=this.getSign(e.name,!1);t?(t.addChild(e),g.resetTransform(e)):(e.removeSelf(),e.destroy())}}get2load(t,e){return __awaiter(this,void 0,void 0,function*(){let a=this.get(t);if(!a){a=(yield d.load(e,Laya.Loader.HIERARCHY)).clone()}return a.active=!0,a.sign=t,a})}get2prefab(t,e){let a=this.get(t);return a||(a=e.clone()),a.active=!0,a.sign=t,a}}class v{constructor(){this.curUrl="",this.curName=""}static get I(){return this._I||(this._I=new this)}open(t,e=!0,a=null,i=null,s=null){return __awaiter(this,void 0,void 0,function*(){this.curUrl=t,this.curName=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")),yield n.playAd(this.curName+"_Open"),n.playAd(this.curName+"_Enable"),n.event(this.curName+"_Open"),Laya.Scene.open(t,e,a,Laya.Handler.create(this,t=>{t.name=this.curName,"function"==typeof t.onCreated&&t.onCreated(a);let e=t.getComponents(Laya.Script);if(e&&e.length)for(let t=0,i=e.length;t<i;t++)"function"==typeof e[t].onCreated&&e[t].onCreated(a);i&&i.run()}),s),x.event("OpenView",this.curName)})}close(){return __awaiter(this,void 0,void 0,function*(){Laya.Scene.closeAll(),this.curName&&(yield n.playAd(this.curName+"_Close"),n.event(this.curName+"_Close"),x.event("CloseView",this.curName),this.curName="")})}}v._I=null;class x{constructor(){x.audio,i.I,x.load.init()}static get I(){return this._I||(this._I=new this),this._I}static get config(){return c.I}static get pool3d(){return b.I}static initPool3d(t){if(this.pool3d)return;let e=t.addChild(new Laya.Sprite3D("Pool3d"));e.addComponent(b),Laya.timer.frameOnce(2,this,()=>{e.active=!1})}static get page(){return _.I}static get curPageUrl(){return this.page?this.page.curUrl:""}static get curPageName(){return this.page?this.page.curName:""}static get view(){return v.I}static get dialog(){return u.I}static get guide(){return m.I}static get audio(){return s.I}static get message(){return w.I}static msg(t,e=1500){return __awaiter(this,void 0,void 0,function*(){yield this.message.msg(t,e)})}static confirm(t){return __awaiter(this,void 0,void 0,function*(){return yield this.message.confirm(t)})}static showLoading(){this.message.showLoading()}static hideLoading(){this.message.hideLoading()}static get load(){return p.I}static hasListener(t){return Laya.stage.hasListener(t)}static event(t,e=null){return Laya.stage.event(t,e)}static on(t,e,a,i=[]){return Laya.stage.on(t,e,a,i)}static once(t,e,a,i=[]){return Laya.stage.once(t,e,a,i)}static off(t,e,a,i=!0){return Laya.stage.off(t,e,a,i)}static offAll(t=null){return Laya.stage.offAll(t)}static offAllCaller(t){return Laya.stage.offAllCaller(t)}}x.isPause=!1,x._I=null;const S="function"==typeof atob,I="function"==typeof btoa,C="function"==typeof Buffer,D="function"==typeof TextDecoder?new TextDecoder:void 0,A="function"==typeof TextEncoder?new TextEncoder:void 0,k=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),B=(t=>{let e={};return k.forEach((t,a)=>e[t]=a),e})(),T=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,R=String.fromCharCode.bind(String),P="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),E=t=>t.replace(/=/g,"").replace(/[+\/]/g,t=>"+"==t?"-":"_"),M=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),V=t=>{let e,a,i,s,o="";const n=t.length%3;for(let n=0;n<t.length;){if((a=t.charCodeAt(n++))>255||(i=t.charCodeAt(n++))>255||(s=t.charCodeAt(n++))>255)throw new TypeError("invalid character found");o+=k[(e=a<<16|i<<8|s)>>18&63]+k[e>>12&63]+k[e>>6&63]+k[63&e]}return n?o.slice(0,n-3)+"===".substring(n):o},N=I?t=>btoa(t):C?t=>Buffer.from(t,"binary").toString("base64"):V,O=C?t=>Buffer.from(t).toString("base64"):t=>{let e=[];for(let a=0,i=t.length;a<i;a+=4096)e.push(R.apply(null,t.subarray(a,a+4096)));return N(e.join(""))},H=(t,e=!1)=>e?E(O(t)):O(t),G=t=>{if(t.length<2){let e=t.charCodeAt(0);return e<128?t:e<2048?R(192|e>>>6)+R(128|63&e):R(224|e>>>12&15)+R(128|e>>>6&63)+R(128|63&e)}{let e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return R(240|e>>>18&7)+R(128|e>>>12&63)+R(128|e>>>6&63)+R(128|63&e)}},U=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,z=t=>t.replace(U,G),W=C?t=>Buffer.from(t,"utf8").toString("base64"):A?t=>O(A.encode(t)):t=>N(z(t)),F=(t,e=!1)=>e?E(W(t)):W(t),q=t=>F(t,!0),Y=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,X=t=>{switch(t.length){case 4:var e=((7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3))-65536;return R(55296+(e>>>10))+R(56320+(1023&e));case 3:return R((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return R((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},j=t=>t.replace(Y,X),J=t=>{if(t=t.replace(/\s+/g,""),!T.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(3&t.length));let e,a,i,s="";for(let o=0;o<t.length;)e=B[t.charAt(o++)]<<18|B[t.charAt(o++)]<<12|(a=B[t.charAt(o++)])<<6|(i=B[t.charAt(o++)]),s+=64===a?R(e>>16&255):64===i?R(e>>16&255,e>>8&255):R(e>>16&255,e>>8&255,255&e);return s},$=S?t=>atob(M(t)):C?t=>Buffer.from(t,"base64").toString("binary"):J,K=C?t=>P(Buffer.from(t,"base64")):t=>P($(t).split("").map(t=>t.charCodeAt(0))),Q=t=>K(tt(t)),Z=C?t=>Buffer.from(t,"base64").toString("utf8"):D?t=>D.decode(K(t)):t=>j($(t)),tt=t=>M(t.replace(/[-_]/g,t=>"-"==t?"+":"/")),et=t=>Z(tt(t)),at=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),it=function(){const t=(t,e)=>Object.defineProperty(String.prototype,t,at(e));t("fromBase64",function(){return et(this)}),t("toBase64",function(t){return F(this,t)}),t("toBase64URI",function(){return F(this,!0)}),t("toBase64URL",function(){return F(this,!0)}),t("toUint8Array",function(){return Q(this)})},st=function(){const t=(t,e)=>Object.defineProperty(Uint8Array.prototype,t,at(e));t("toBase64",function(t){return H(this,t)}),t("toBase64URI",function(){return H(this,!0)}),t("toBase64URL",function(){return H(this,!0)})},ot={version:"3.7.5",VERSION:"3.7.5",atob:$,atobPolyfill:J,btoa:N,btoaPolyfill:V,fromBase64:et,toBase64:F,encode:F,encodeURI:q,encodeURL:q,utob:z,btou:j,decode:et,isValid:t=>{if("string"!=typeof t)return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+\/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},fromUint8Array:H,toUint8Array:Q,extendString:it,extendUint8Array:st,extendBuiltins:()=>{it(),st()}};class nt{constructor(){this.gameDataMap=null,this.___localStorage_gameData="___localStorage_gameData",this.read()}getKey(){return""}getValue(){return null}setValue(t){}init(){}delete(){let t=this.getKey();Laya.LocalStorage.removeItem(t);this.saveData(t,"null")}read(){this.gameDataMap||(this.gameDataMap=new Map);let t=this.getKey(),e=this.getGameData([t]).get(t);if(e){let t=e.value;return"null"!=t&&(this.setValue(JSON.parse(t)),!0)}{let t=Laya.LocalStorage.getItem(this.getKey());return t?(this.setValue(JSON.parse(ot.decode(t))),!0):(this.init(),!1)}}save(){let t=this.getKey(),e=JSON.stringify(this.getValue());this.saveData(t,e)}saveData(t,e){let a=this.getGameDataByKey(t);a?(a.value=e,this.saveLocalGameData(a)):(a={key:t,value:e,version:1,flush:!0},this.saveLocalGameData(a))}getGameData(t){for(let e=0;e<t.length;e++){const a=t[e];this.getGameDataByKey(a)}return this.gameDataMap}getGameDataByKey(t){let e=this.gameDataMap.get(t);return e||(e=this.getLocalGameData(t))&&this.gameDataMap.set(t,e),e}saveLocalGameData(t){try{let e=ot.encode(JSON.stringify(t));Laya.LocalStorage.setItem(this.___localStorage_gameData+"_"+t.key,e)}catch(e){console.error("saveLocalGameData __ gameData:",t,"___error:",e)}}getLocalGameData(t){let e=Laya.LocalStorage.getItem(this.___localStorage_gameData+"_"+t);return e?JSON.parse(ot.decode(e)):null}}const rt=5;class lt extends nt{constructor(){super(),this._baseData=null,this.read(),this.checkIsNewDay()}getKey(){return ut.baseData}getValue(){return this._baseData}setValue(t){this._baseData=t,null==this._baseData.guide&&(this._baseData.guide=0),null==this._baseData.power&&(this._baseData.power=rt),null==this._baseData.zd&&(this._baseData.zd=1),null==this._baseData.yy&&(this._baseData.yy=0),null==this._baseData.shuffle&&(this._baseData.shuffle=1),null==this._baseData.chehuiCount&&(this._baseData.chehuiCount=1),null==this._baseData.yichuCount&&(this._baseData.yichuCount=1),null==this._baseData.difficultyOrder&&(this._baseData.difficultyOrder=""),null==this._baseData.waveID&&(this._baseData.waveID=1),null==this._baseData.waveID_difficultyID&&(this._baseData.waveID_difficultyID=""),null==this._baseData.lastDayZero&&(this._baseData.lastDayZero=0),null==this._baseData.alreadyVideoAdTime&&(this._baseData.alreadyVideoAdTime=0),null==this._baseData.dailyShareTime&&(this._baseData.dailyShareTime=0),null==this._baseData.isConfirmPrivate&&(this._baseData.isConfirmPrivate=!1),null==this._baseData.collectState&&(this._baseData.collectState=0),null==this._baseData.addDesktopState&&(this._baseData.addDesktopState=0),null==this._baseData.giveProp&&(this._baseData.giveProp=0),null==this._baseData.propNumList&&(this._baseData.propNumList={}),null==this._baseData.loginNum&&(this._baseData.loginNum=0),null==this._baseData.shuaXin&&(this._baseData.shuaXin=0),null==this._baseData.daBao&&(this._baseData.daBao=0),null==this._baseData.qingKong&&(this._baseData.qingKong=0),null==this._baseData.renYiZhi&&(this._baseData.renYiZhi=0),null==this._baseData.tiSHi&&(this._baseData.tiSHi=0),null==this._baseData.exp&&(this._baseData.exp=0),null==this._baseData.firstEnter&&(this._baseData.firstEnter=1),null==this._baseData.coin&&(this._baseData.coin=1e4),null==this._baseData.lvEarn&&(this._baseData.lvEarn=1),null==this._baseData.lvRole&&(this._baseData.lvRole=1)}init(){this._baseData={star:0,power:rt,addTime:Math.floor((new Date).getTime()/1e3),tip:0,shuffle:0,loginDate:0,shareScore:80,yy:1,yx:1,zd:1,guide:0,chehuiCount:1,yichuCount:1,updateScoreTime:0,weekScore:0,difficultyOrder:"",waveID:1,waveID_difficultyID:"",lastDayZero:new Date((new Date).toLocaleDateString()).getTime(),alreadyVideoAdTime:0,dailyShareTime:0,isConfirmPrivate:!1,collectState:0,addDesktopState:0,giveProp:0,propNumList:{},loginNum:0,shuaXin:0,daBao:0,qingKong:0,renYiZhi:0,tiSHi:0,exp:0,firstEnter:1,coin:1e4,lvEarn:1,lvRole:1}}setZD(t){this._baseData.zd=t?1:0,this.save()}getZD(){return 1==this._baseData.zd}findByArea(t,e,a){for(let i=0;i<e.length;i++){const s=e[i];if(t==s.province&&s.score==a)return s.count}return 0}reducePower(){this._baseData.power>=rt&&(this._baseData.addTime=Math.floor((new Date).getTime()/1e3)),this._baseData.power-=1,this.save()}checkIsNewDay(){let t=new Date((new Date).toLocaleDateString()).getTime();t-this._baseData.lastDayZero>=864e5&&(this._baseData.lastDayZero=t,this._baseData.dailyShareTime=0,this.save())}}var ht,dt,ct,ut;!function(t){t.default="default"}(ht||(ht={})),function(t){t.default="default"}(dt||(dt={})),function(t){t.xianhua="xianhua",t.chuansongdai="chuansongdai",t.qiqiu="qiqiu",t.wanyiwan="wanyiwan"}(ct||(ct={})),function(t){t.baseData="__superzle_baseData"}(ut||(ut={}));const gt=new class{constructor(){this.baseData=null,this.count=0}init(){this.baseData=new lt}getBaseData(){return this.baseData}};class mt extends Laya.Script{constructor(){super(...arguments),this.coinLabel=null}onEnable(){this.freshView(),this.resign()}freshView(){this.coinLabel.text=gt.baseData._baseData.coin+""}resign(){x.on(t.coin_change,this,this.freshView)}}var pt,ft,yt;!function(t){t.SetDialog="gameui/dialog/SetDialog.scene",t.GameUI="gameui/scene/GameUI.scene",t.HomeDialog="gameui/dialog/HomeDialog.scene",t.EndDialog="gameui/dialog/EndDialog.scene"}(pt||(pt={}));class wt extends Laya.Script{constructor(){super(),this.curAd={CustomSingleLeft:!0,CustomSingleRight:!0,CustomRow1Top:!0,BottomSwitch:!0}}onCreated(t){}onAwake(){let t=Laya.stage.height-this.owner.height;this.owner.height=Laya.stage.height,this.owner.y-=t/2}onEnable(){}onDisable(){}close(t=null){this.owner.closeReturnData=t,this.owner.close()}}!function(t){t[t.omnipotent=1]="omnipotent",t[t.remove=2]="remove",t[t.shuffle=3]="shuffle"}(ft||(ft={})),function(t){t[t.task=1]="task",t[t.addDesktop=2]="addDesktop",t[t.collect=3]="collect",t[t.share=4]="share"}(yt||(yt={}));class _t{constructor(t){this.waveConfig=null,this.difficulty=null,this.propItem=null,this.blockItem=null,this.passReward=null,this.roleCfg=null,this.enemyCfg=null,this.roadItem=null,this.waveConfig=t.level,this.difficulty=t.gameDifficulty,this.propItem=t.propItem,this.blockItem=t.blockItem,this.passReward=t.passReward,this.roleCfg=t.role,this.enemyCfg=t.enemyConfig,this.roadItem=t.roadItem}getWaveById(t){for(let e=0,a=this.waveConfig.length;e<a;e++){let a=this.waveConfig[e],i=a.waveRange[0],s=a.waveRange[1];if(t>=i&&t<=s)return this.getByConfigType(a);if(t>=i&&-1==s)return this.getByConfigType(a)}}getByConfigType(t){if(t.difficultyIdOrder.length>0){let e,a=0,i=t.id,s=gt.baseData._baseData.difficultyOrder;if(""!=s){let t=s.split("_");parseInt(t[0])==i?a=parseInt(t[1]):(s=i+"_"+a,gt.baseData._baseData.difficultyOrder=s,gt.baseData.save())}else s=i+"_"+a,gt.baseData._baseData.difficultyOrder=s,gt.baseData.save();return a>=t.difficultyIdOrder.length&&(console.error("难度顺序ID_超出,重置为0"),s=i+"_"+(a=0),gt.baseData._baseData.difficultyOrder=s,gt.baseData.save()),e=t.difficultyIdOrder[a],this.getDifficultyDataById(e)}{let e=t.difficultyId,a=e[Math.floor(Math.random()*e.length)];return this.getDifficultyDataById(a)}}getDifficultyDataById(t,e=!0){for(let a=0,i=this.difficulty.length;a<i;a++){let i=this.difficulty[a];if(i.id==t)return e&&console.log("* 难度ID__",i.id," * 难度内容__",i),i}}passWave(){gt.baseData._baseData.waveID+=1,gt.baseData._baseData.waveID=gt.baseData._baseData.waveID%5,0==gt.baseData._baseData.waveID&&(gt.baseData._baseData.waveID=1);let t=gt.baseData._baseData.difficultyOrder;if(t){let e=t.split("_"),a=e[0],i=parseInt(e[1]);i+=1,gt.baseData._baseData.difficultyOrder=a+"_"+i}gt.baseData.save()}getPropNum(t){let e=gt.baseData._baseData.propNumList;return e[t]?e[t]:0}setPropNum(t,e){e=e||0,gt.baseData._baseData.propNumList[t]=e,gt.baseData.save()}changePropNum(t,e){let a=this.getPropNum(t);a+=e,a=Math.max(a,0),this.setPropNum(t,a)}getPropCfgById(t){for(let e=0;e<this.propItem.length;e++)if(t==this.propItem[e].id)return this.propItem[e]}getBlockCfgByName(t){for(let e=0;e<this.blockItem.length;e++)if(t==this.blockItem[e].name)return this.blockItem[e];console.error(t,"***  getBlockCfgByName  **")}getPassRewardByWaveID(t){t>this.passReward.length&&(t%=this.passReward.length);for(let e=0;e<this.passReward.length;e++){const a=this.passReward[e];if(a.id==t)return a}return this.passReward[0]}getLastUnlockRole(){let t=gt.baseData._baseData.waveID;t>this.passReward.length&&0==(t%=this.passReward.length)&&(t=this.passReward.length);let e=1,a=0;for(let i=0;i<this.passReward.length;i++){const s=this.passReward[i];t>s.id&&s.role&&(e=s.role,a=s.id)}return{roleID:e,waveID:a}}getNextUnlockRole(){let t=gt.baseData._baseData.waveID;t>this.passReward.length&&(t%=this.passReward.length);let e=-1,a=0;for(let i=0;i<this.passReward.length;i++){const s=this.passReward[i];if(t<=s.id&&s.role&&(e=s.role,a=s.id),e>0)break}return e<=0&&(e=1),{roleID:e,waveID:a}}getRoleCfgByID(t){for(let e=0;e<this.roleCfg.length;e++){const a=this.roleCfg[e];if(a.id==t)return a}}getEnemyCfgByID(t){for(let e=0;e<this.enemyCfg.length;e++){const a=this.enemyCfg[e];if(a.id==t)return a}}getRoadCfgByName(t){for(let e=0;e<this.roadItem.length;e++){const a=this.roadItem[e];if(a.name==t)return a}}}const Lt=new class{constructor(){this.gameData=null}init(t){t=this.decodeData(t),this.gameData=new _t(t)}decodeData(t){if(t.flag&&t.data){let e=ot.decode(t.data);return JSON.parse(e)}return console.error("配置未加密，请确认。"),t}};class bt extends wt{constructor(){super(...arguments),this.totalHeight=460.8,this.gameplay=null,this.isWin=!1}onCreated(t){if(this.gameplay=t[0],this.isWin=t[1],this.win.visible=this.isWin,this.lose.visible=!this.isWin,this.rewardAni.visible=!1,this.isWin){let e=t[2];this.rewardLabel.text=e+"";let a=t[3];if(a){x.audio.playSound("sound/Win_Screen.mp3"),this.rewardAni.visible=!0,this.rewardAni.play(0,!0);let t=Lt.gameData.getRoleCfgByID(a);this.nextRole.skin=t.textureUrl,this.role2.skin=t.textureUrl,this.maskRect.height=this.totalHeight,this.unlockLabel.text="解锁新角色"}else{x.audio.playSound("sound/GATES_GROW.mp3");let t=Lt.gameData.getNextUnlockRole(),e=t.roleID,a=Lt.gameData.getRoleCfgByID(e);this.nextRole.skin=a.textureUrl,this.role2.skin=a.textureUrl;let i=t.waveID,s=i-Lt.gameData.getLastUnlockRole().waveID,o=gt.baseData._baseData.waveID;o>Lt.gameData.passReward.length&&(o%=Lt.gameData.passReward.length);let n=i-o+1,r=Math.floor((s-n)/s*100)+"%";this.maskRect.height=this.totalHeight*(n/s),this.unlockLabel.text=r}this.nextBtn.on(Laya.Event.MOUSE_DOWN,this,t=>{this.gameplay.restart(),x.dialog.open(pt.HomeDialog,!0,this.gameplay)})}else x.audio.playSound("sound/Try Again.mp3"),this.tryAgain.on(Laya.Event.MOUSE_DOWN,this,t=>{this.gameplay.restart(),x.dialog.open(pt.HomeDialog,!0,this.gameplay)})}onEnable(){}onDisable(){this.nextBtn.offAllCaller(this),this.tryAgain.offAllCaller(this)}}class vt{constructor(t,e){this.q=t,this.r=e}toString(){return`${this.q},${this.r}`}}class xt{static generateHexMap(t=this.mapRadius){const e=[];for(let a=-t;a<=t;a++){const i=Math.max(-t,-a-t),s=Math.min(t,-a+t);for(let t=i;t<=s;t++)e.push(new vt(a,t))}return e}static axialToWorld(t,e=this.hexSize,a=this.spacing){const i=(e+a)*(Math.sqrt(3)*t.q+Math.sqrt(3)/2*t.r),s=(e+a)*(1.5*t.r);return new Laya.Point(i,s)}static generateRadiusMap(t){const e=new Map;let a=new Set;for(let i=0;i<=t;i++){const t=this.generateHexMap(i),s=[];for(const e of t)a.has(e.toString())||s.push(e);e.set(i,s);for(const e of t)a.add(e.toString())}return e}static getCoordinatesInDirection(t,e,a){const i=[];for(let s=1;s<=a;s++){const a=t.q+e.q*s,o=t.r+e.r*s;i.push(new vt(a,o))}return i}static test(){const t=this.hexDirections[this.directionIndex];this.getCoordinatesInDirection(this.start,t,this.directionIndex).forEach(t=>{console.log(`Coordinate: (${t.q}, ${t.r})`);let e=this.axialToWorld(t,this.hexSize,this.spacing);console.warn(e,"testP")})}}xt.hexSize=.001,xt.mapRadius=5,xt.spacing=.045,xt.hexDirections=[new vt(1,0),new vt(1,-1),new vt(0,-1),new vt(-1,0),new vt(-1,1),new vt(0,1)],xt.start=new vt(0,0),xt.directionIndex=1;class St{constructor(){this.blockDataList=[],this.dataBase=null,this.roadIns=null}}class It{constructor(){this.insList=[],this.parentNode=null}}class Ct{constructor(){this.roleIns=null,this.AxialPos=null,this.keyAxial=0,this.canMove=!1,this.canHitSelf=!0,this.isJumping=!1,this.jumpT=0}}class Dt extends Laya.Script{constructor(){super(),this.characters=[],this.centerPoint=new Laya.Vector3(0,0,0),this.maxRow=10,this.prefab_wid=.1,this.road_wid=1,this.leftBoundary=1,this.rightBoundary=1,this.topBoundary=1,this.bottomBoundary=1,this.curRange=[3,3],this.minSpacing=.1,this.moveFun=[],this._v3_update=new Laya.Vector3,this.cdMoveCenter=500,this.hasKnock=!1,this.lastDistance=0,this.closeCount=0}onAwake(){this.registerEvent()}onUpdate(){this.calculateCenter(),this.updateCharacter(),this.updateMoveLefp(),this.cdMoveCenter>0&&(this.cdMoveCenter-=Laya.timer.delta,this.cdMoveCenter<=0&&this.hasKnock&&this.moveToCenter());const t=this.calculateCenter();this._v3_update.setValue(t.x,0,t.y);let e=g.worldToScreen(this._v3_update,this.Gameplay.camera);this.Gameplay.freshCountTag(e,this.characters.length)}initCharactersMgr(t){this.prefab_wid=.15,console.log("人物尺寸",this.prefab_wid),this.prefab_role=t,this.refreshRoad(this.road_wid),this.characterAxialMap=xt.generateRadiusMap(8),this.addCharacter(gt.baseData._baseData.lvRole)}freshHomeCharacter(){let t=this.characters.length,e=gt.baseData._baseData.lvRole;if(e-t>0){let a=e-t;this.addCharacter(a)}}reduceCharacter(t,e=!1){let a=this.characters.length-t<=0?1:this.characters.length-t;for(let t=this.characters.length-1;t>=0;t--){let e=this.characters[t];if(this.Gameplay.recoverRole(this.characters[t]),this.characters[t]=null,e=null,this.characters.splice(t,1),a==this.characters.length)break}Laya.timer.frameOnce(1,this,()=>{this.moveToCenter()}),e&&this.playEffectWhite()}forceUpMovePos(){for(let t=0;t<this.moveFun.length;t++){(0,this.moveFun[t])(!0)}}addCharacter(t,e=!0){this.forceUpMovePos();for(let e=0;e<t;e++){let t,e;for(const[a,i]of this.characterAxialMap)if(i.length>0){t=i.splice(0,1)[0],e=a;break}if(t){let a=this.createCharacter();this.characters.push(a),this.Gameplay.gameStart?this.owner.addChild(a.roleIns):this.Gameplay.idlePos.addChild(a.roleIns),a.roleIns.transform.localPosition=new Laya.Vector3(0,0,0),a.AxialPos=t,a.keyAxial=e}}let a=this.calculateCenter();this.Gameplay.gameStart||(a.x=0);let i=0-a.x;for(let t=0;t<this.characters.length;t++){const e=this.characters[t];let a=xt.axialToWorld(e.AxialPos);this.moveToTarget(e.roleIns,new Laya.Vector3(a.x-i,e.roleIns.transform.localPosition.y,a.y),.5)}e&&this.playEffectAdd(),this.Gameplay.gameStart&&this.playMoveAni()}playEffectWhite(){let t=Laya.Loader.getRes("3dAssest/LayaScene_RoleExport/Conventional/effect_whiteBoom.lh"),e=Laya.Sprite3D.instantiate(t);this.owner.addChild(e);let a=this.calculateCenter();e.transform.position=new Laya.Vector3(a.x,0,a.y);let i=e.getChildAt(0),s=e.getChildAt(1);i&&i.particleSystem.play(),s&&s.particleSystem.play()}playEffectAdd(){let t=Laya.Loader.getRes("3dAssest/LayaScene_RoleExport/Conventional/effect_orangeBoom.lh"),e=Laya.Sprite3D.instantiate(t);this.owner.addChild(e);let a=this.calculateCenter();e.transform.position=new Laya.Vector3(a.x,0,a.y);let i=e.getChildAt(0);i&&i.particleSystem.play()}moveToCenter(){}playMoveAni(){for(let t=0;t<this.characters.length;t++){let e=this.characters[t];e.roleIns.transform.localScale.x>1&&(e.roleIns.transform.localScale=new Laya.Vector3(1,1,1)),e.roleIns.getChildByName("animatorNode").getComponent(Laya.Animator).play("Move",0,0)}}changeParentNode(){for(let t=0;t<this.characters.length;t++){let e=this.characters[t];const a=e.roleIns;a.removeSelf(),this.owner.addChild(a);let i=xt.axialToWorld(e.AxialPos);a.transform.localPosition=new Laya.Vector3(i.x,0,i.y)}}createCharacter(){let t,e=Lt.gameData.getLastUnlockRole().roleID,a=Lt.gameData.getRoleCfgByID(e).textureUrl;(t=x.pool3d.getSign(this.prefab_role.name,!1))||(t=Laya.Sprite3D.instantiate(this.prefab_role,null,!1,new Laya.Vector3(0,0,0))),t.active=!0;let i=new Ct;i.roleIns=t,t.transform.position=new Laya.Vector3(0,0,0);let s=t.getChildAt(0).getChildAt(0).getChildAt(0).getChildAt(0);return Laya.Texture2D.load(a,Laya.Handler.create(null,t=>{let e=s.meshRenderer;if(e&&e.material){let a=t;if(a){e.material.albedoTexture=a}}})),Math.abs(t.transform.position.x)>5&&console.error(t.transform),i}moveToTarget(t,e,a=.02,i){let s=0;const o=new Laya.Vector3(t.transform.localPosition.x,t.transform.localPosition.y,t.transform.localPosition.z);this.moveFun.push((n=!1)=>{if(n){s=1;let a=new Laya.Vector3;Laya.Vector3.lerp(o,e,s,a),t.transform.localPosition=a}if(!(s<1))return console.log("移动完成"),i&&i(),!0;{s+=a;let i=new Laya.Vector3;Laya.Vector3.lerp(o,e,s,i),t.transform.localPosition=i}return!1})}cleanLastMove(){this.forceUpMovePos()}updateMoveLefp(){for(let t=this.moveFun.length-1;t>=0;t--){let e=this.moveFun[t];if(e){e()&&this.moveFun.splice(t,1),e=null}}}refreshRoad(t){this.road_wid=t,this.leftBoundary=-this.road_wid/2,this.rightBoundary=this.road_wid/2,this.topBoundary=.8,this.bottomBoundary=-.8}registerEvent(){let t=0,e=!1;Laya.stage.on(Laya.Event.MOUSE_DOWN,this,a=>{this.Gameplay.stopHand||(t=a.stageX,e=!0)}),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,a=>{if(!this.Gameplay.stopHand&&e){const e=-1*(a.stageX-t)/600;this.moveAllRole(e),t=a.stageX}}),Laya.stage.on(Laya.Event.MOUSE_UP,this,t=>{e=!1})}moveAllRole(t){if(!this.Gameplay.gameStart)return;if(0==this.lastDistance&&(this.lastDistance=t>0?1:-1),(t>0&&this.lastDistance<0||t<0&&this.lastDistance>0)&&(this.closeCount=0),this.closeCount>=8)return;let e=-this.road_wid/2,a=this.road_wid/2;for(let i=0;i<this.characters.length;i++){const s=this.characters[i].roleIns;let o=s.transform.position.x+t;if(o=Math.max(e,Math.min(a,o)),s.transform.position=new Laya.Vector3(o,s.transform.position.y,s.transform.position.z),t>0&&o>=a-.015&&(this.closeCount+=1),t<.015&&o<=e&&(this.closeCount+=1),this.closeCount>=8)break}}updateCharacter(){this.Gameplay.stopHand||(this.checkBoundaries(),this.adjustCharacterSpacing())}checkBoundaries(){for(const t of this.characters){if(t.roleIns.transform.localPosition.x-this.prefab_wid/2<this.leftBoundary){const e=this.leftBoundary+this.prefab_wid/2,a=t.roleIns.transform.localPosition.y,i=t.roleIns.transform.localPosition.z;t.roleIns.transform.localPosition=new Laya.Vector3(e,a,i)}if(t.roleIns.transform.localPosition.x+this.prefab_wid/2>this.rightBoundary){const e=this.rightBoundary-this.prefab_wid/2,a=t.roleIns.transform.localPosition.y,i=t.roleIns.transform.localPosition.z;t.roleIns.transform.localPosition=new Laya.Vector3(e,a,i)}if(t.roleIns.transform.localPosition.z-this.prefab_wid/2<this.bottomBoundary){const e=this.bottomBoundary+this.prefab_wid/2,a=t.roleIns.transform.localPosition.x,i=t.roleIns.transform.localPosition.y;t.roleIns.transform.localPosition=new Laya.Vector3(a,i,e)}if(t.roleIns.transform.localPosition.z+this.prefab_wid/2>this.topBoundary){const e=this.topBoundary-this.prefab_wid/2,a=t.roleIns.transform.localPosition.x,i=t.roleIns.transform.localPosition.y;t.roleIns.transform.localPosition=new Laya.Vector3(a,i,e)}}}adjustCharacterSpacing(){for(let t=0;t<this.characters.length;t++)for(let e=t+1;e<this.characters.length;e++){const a=this.characters[t].roleIns,i=this.characters[e].roleIns;this.calculateDistance(a,i)<this.minSpacing&&this.pushCharactersApart(a,i)}}pushCharactersApart(t,e){const a=t.transform.localPosition.x-e.transform.localPosition.x,i=t.transform.localPosition.z-e.transform.localPosition.z,s=this.calculateDistance(t,e),o=(this.minSpacing-s)/2;t.transform.localPosition=new Laya.Vector3(t.transform.localPosition.x+a/s*o,t.transform.localPosition.y,t.transform.localPosition.z+i/s*o),e.transform.localPosition=new Laya.Vector3(e.transform.localPosition.x-a/s*o,e.transform.localPosition.y,e.transform.localPosition.z-i/s*o)}calculateDistance(t,e){const a=t.transform.localPosition.x-e.transform.localPosition.x,i=t.transform.localPosition.z-e.transform.localPosition.z;return Math.sqrt(a*a+i*i)}calculateCenter(){let t=0,e=0,a=this.characters.length;if(!a||0==a)return console.error(this.characters),{x:0,y:0};a=a||0;for(let a=0;a<this.characters.length;a++){const i=this.characters[a].roleIns;let s=i.transform.position.x,o=i.transform.position.z;(Number.isNaN(s)||Number.isNaN(o))&&(console.error("计算中心点",i.transform.position),i.transform.localPosition=new Laya.Vector3(0,0,0)),Math.abs(s)>5&&console.error(i.transform),t+=s,e+=o}return{x:t/a,y:e/a}}}class At extends wt{constructor(){super(...arguments),this.gameplay=null}onCreated(t){this.gameplay=t,this.bgBtn.on(Laya.Event.MOUSE_DOWN,this,t=>{this.gameplay.clickStartGame(),this.close()}),this.addCharacter.on(Laya.Event.MOUSE_DOWN,this,this.clickAddRole),this.addEarn.on(Laya.Event.MOUSE_DOWN,this,this.clickAddEarn),this.setBtn.on(Laya.Event.MOUSE_DOWN,this,this.showSetting),this.arrowRoleAni.play(0,!0),this.arrowCoinAni.play(0,!0),this.upRoleAni.stop(),this.upCoinAni.stop()}onEnable(){this.freshTopUI(),this.freshButtonView(),x.on(t.coin_change,this,this.freshButtonView)}freshTopUI(){let t=gt.baseData._baseData.waveID,e=3*Math.ceil(t/3)-2,a=e;for(let i=0;i<3;i++){a=e+i;let s="box"+(i+1),o=this.waveBox.getChildByName(s),n=o.getChildByName("cur"),r=o.getChildByName("finish"),l=o.getChildByName("idx"),h=o.getChildByName("unlock");h.visible=!1,n.visible=!1,l.visible=!1,r.visible=!1;let d=Lt.gameData.getPassRewardByWaveID(a);if(a<t)r.visible=!0;else if(t==a)if(n.visible=!0,d.role>0){h.visible=!0;let t=Lt.gameData.getRoleCfgByID(d.role);h.skin=t.icon}else n.visible=!0,l.visible=!0,l.text=a+"";else if(d.role>0){h.visible=!0;let t=Lt.gameData.getRoleCfgByID(d.role);h.skin=t.icon}else l.visible=!0,l.text=a+""}}freshButtonView(){let t=this.getEarnCostPrice(),e=this.getRoleCostPrice();gt.baseData._baseData.coin>=t?this.addEarn.gray=!1:this.addEarn.gray=!0,gt.baseData._baseData.coin>=e?this.addCharacter.gray=!1:this.addCharacter.gray=!0,this.rolePrice.text=t+"",this.earnPrice.text=e+"",this.lvEarn.text="Lv."+gt.baseData._baseData.lvEarn,this.lvRole.text="Lv."+gt.baseData._baseData.lvRole}getRoleCostPrice(){return 300*gt.baseData._baseData.lvRole}getEarnCostPrice(){return 500*gt.baseData._baseData.lvEarn}clickAddRole(){let t=this.getRoleCostPrice();if(this.checkIsEnough(t)){gt.baseData._baseData.lvRole+=1,gt.baseData.save(),this.gameplay.roleBox.getComponent(Dt).freshHomeCharacter(),this.upRoleAni.play(0,!1),x.audio.playSound("sound/upgrade_complete.mp3"),this.freshButtonView()}}clickAddEarn(){let t=this.getEarnCostPrice();this.checkIsEnough(t)&&(this.upCoinAni.play(0,!1),x.audio.playSound("sound/upgrade_complete.mp3"),gt.baseData._baseData.lvEarn+=1,gt.baseData.save(),this.freshButtonView())}checkIsEnough(e){return gt.baseData._baseData.coin>=e&&(gt.baseData._baseData.coin-=e,gt.baseData.save(),x.event(t.coin_change),!0)}showSetting(){x.dialog.open(pt.SetDialog,!1)}}class kt extends wt{constructor(){super()}onEnable(){this.openSoundFlag.visible=x.audio.soundMuted,this.openMusicFlag.visible=x.audio.musicMuted,this.openShakeFlag.visible=i.isVibrate,this.closeBtn.on(Laya.Event.MOUSE_DOWN,this,t=>{this.close()}),this.closeBg.on(Laya.Event.MOUSE_DOWN,this,t=>{this.close()}),this.openSound.on(Laya.Event.MOUSE_DOWN,this,t=>{this.openSoundFlag.visible=!this.openSoundFlag.visible,x.audio.soundMuted=!x.audio.soundMuted}),this.openMusic.on(Laya.Event.MOUSE_DOWN,this,t=>{this.openMusicFlag.visible=!this.openMusicFlag.visible,x.audio.musicMuted=!x.audio.musicMuted}),this.openShake.on(Laya.Event.MOUSE_DOWN,this,t=>{i.isVibrate=!i.isVibrate,this.openShakeFlag.visible=!this.openShakeFlag.visible})}}class Bt{static randomIndexArray(t,e){let a=[];for(let e=0;e<t;e++)a.push(e);return a.sort(()=>Math.random()>.5?1:-1),a.slice(0,e)}static randomElementArray(t,e){for(var a,i,s=t.slice(0),o=t.length,n=o-e;o-- >n;)a=s[i=Math.floor((o+1)*Math.random())],s[i]=s[o],s[o]=a;return s.slice(n)}static randomElement(t){return t[Math.floor(Math.random()*t.length)]}static intersect(t,e){let a=[];for(let i=0;i<e.length;i++)for(let s=0;s<t.length;s++)t[s]===e[i]&&a.push(t[s]);return a}static removeElement(t,e,a=!1){if(a){for(let a=t.length-1;a>=0;a++)t[a]===e&&t.splice(a,1);return t}{let a=t.indexOf(e);return-1===a?t:t.splice(a,1)}}static unique(t){if(Array.isArray(t)){for(var e=[],a=0;a<t.length;a++)-1===e.indexOf(t[a])&&e.push(t[a]);return e}console.warn("type error!")}static merge(t,e,a=null,i=null,s=null){let o=[...t,...e];return a&&a.length>0&&(o=o.concat(a)),i&&i.length>0&&(o=o.concat(i)),s&&s.length>0&&(o=o.concat(s)),o}static mergeUnique(t,e,a=null,i=null,s=null){return this.unique(this.merge(t,e,a,i,s))}static diff(t,e){return t.filter(t=>e.every(e=>t!==e))}static randomSort(t){return void 0===t?[]:t.sort(()=>Math.random()-.5)}static ascSort(t,e=null){return void 0===t?[]:t.sort((t,a)=>e?t[e]-a[e]:t-a)}static descSort(t,e=null){return void 0===t?[]:t.sort((t,a)=>e?a[e]-t[e]:a-t)}static deepClone(t){if(!Array.isArray(t))return t;const e=[];for(const a of t)"object"==typeof a&&null!==a?e.push(Array.isArray(a)?Bt.deepClone(a):Object.assign({},Bt.deepClone(a))):e.push(a);return e}static findElement(t,e){for(let a=0;a<t.length;a++)if(e(t[a]))return t[a]}static findIndex(t,e){for(let a=0;a<t.length;a++)if(t[a]===e)return a;return-1}}class Tt{static testPointInCollider(t,e){return t.x/=Laya.Physics.PIXEL_RATIO,t.y/=Laya.Physics.PIXEL_RATIO,e._shape.TestPoint(e.rigidBody._body.m_xf,t)}static isColliding(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}static isRectCollision(t,e){let a=t.x-t.width/2,i=t.x+t.width/2,s=e.x-e.width/2,o=e.x+e.width/2,n=i>s&&a<o,r=t.y-t.height/2,l=t.y+t.height/2,h=e.y-e.height/2,d=e.y+e.height/2;return n&&(l>h&&r<d)}}class Rt extends Laya.Script{constructor(){super(...arguments),this.canHit=!0,this.hitObject="roleIns"}isOnCollision(t,e){}isItemOnCollision(t,e,a){if(!t.canHitSelf)return;a.recoverRole(t);let i=Bt.findIndex(e.characters,t);return e.characters[i]=null,e.characters.splice(i,1),t=null,0==e.characters.length&&a.GameOver(),!0}}class Pt extends Rt{constructor(){super(),this.number3Pos=[.09,0,-.09],this.number2Pos=[.06,-.06],this.canHit=!0,this.hitObject="roleBox",this.bindRoad=null}isOnCollision(t){if(this.canHit){if(x.audio.playSound("sound/add_units.mp3"),this.canHit=!1,this.offOtherProp(),101==this.type&&t.addCharacter(this.count),201==this.type&&t.reduceCharacter(this.count,!0),102==this.type){let e=this.count*t.characters.length-t.characters.length;t.addCharacter(e)}if(202==this.type){let e=Math.ceil(t.characters.length/this.count),a=t.characters.length-e;t.reduceCharacter(a)}this.owner.getChildAt(0).active=!1}}initNumber(t,e,a){let i,s=t.getChildByName("numberNode");if(!s)return console.error("blockIns.getChildByName(numberNode)",t);s&&s.numChildren>0&&(s.destroyChildren(),console.log("销毁上一次遗留的")),this.type=1==a?e.buffType1:e.buffType2;let o=1==a?e.buffRange1:e.buffRange2,n=o[0],r=o[1];this.count=n!=r?Math.floor(Math.random()*n+(r-n)):r,101==this.type&&(i="UI_Game/Num_+.png"),102==this.type&&(i="UI_Game/Num_x.png"),201==this.type&&(i="UI_Game/Num_-.png"),202==this.type&&(i="UI_Game/Num_÷.png");let l=[i],h=this.count.toString().split("");for(let t=0;t<h.length;t++){let e="UI_Game/Num_"+h[t]+".png";l.unshift(e)}for(let t=0;t<l.length;t++){let e="3dAssest/LayaScene_RoleExport/Conventional/prefab_numer.lh",a=Laya.Sprite3D.instantiate(Laya.Loader.getRes(e));s.addChild(a);let i=l.length<3?this.number2Pos:this.number3Pos;const o=l[t];Laya.Texture2D.load(o,Laya.Handler.create(null,e=>{let s=a.meshRenderer;if(s&&s.material){let o=s.material,n=e;n&&(o.albedoTexture=n,a.transform.localPosition=new Laya.Vector3(i[t],0,0))}}))}}offOtherProp(){let t=this.bindRoad.blockDataList;for(let e=0;e<t.length;e++){let a=t[e].parentNode.getComponent(Pt);a&&(a.canHit=!1)}}}class Et extends Rt{constructor(){super(),this.canHit=!0,this.hitObject="roleBox",this.firstHit=!0,this.width=.1,this.height=.1}onDisable(){}onFirstHit(t,e){if(this.firstHit){this.firstHit=!1,t.Gameplay.stopToFight();const a=new Laya.Vector3(.05*Math.random(),0,e.parentNode.transform.position.z-.7),i=new Laya.Vector3(.05*Math.random(),0,e.parentNode.transform.position.z-.6);for(let t=0;t<e.insList.length;t++){const i=e.insList[t];this.moveToTarget(i,a,.02)}t.cleanLastMove();for(let e=0;e<t.characters.length;e++){const a=t.characters[e].roleIns;this.moveToTarget(a,i,.02)}}}isOnCollision(t,e){if(this.canHit){this.onFirstHit(t,e);let a=[];for(let e=0;e<t.characters.length;e++){const i=t.characters[e];a.push(i.roleIns)}const[i,s]=this.eliminateSoldiers(e.insList,a);for(let a=i.length-1;a>=0;a--){let s=i[a],o=Bt.findIndex(e.insList,s);-1!=o&&e.insList.splice(o,1),t.Gameplay.playEffectDead(s),x.pool3d.recover(s.name,s),i.splice(a,1),s=null}for(let e=s.length-1;e>=0;e--){let a=s[e];for(let e=0;e<t.characters.length;e++){let i=t.characters[e];if(i.roleIns==a){t.Gameplay.recoverRole(i),i=null,t.characters[e]=null,t.characters.splice(e,1);break}}a=null}if(0==t.characters.length&&(t.cleanLastMove(),Laya.timer.clearAll(this),this.canHit=!1,t.Gameplay.GameOver()),0==e.insList.length){this.canHit=!1,t.cleanLastMove(),Laya.timer.clearAll(this);for(let e=0;e<t.characters.length;e++){const a=t.characters[e],i=a.roleIns;let s=xt.axialToWorld(a.AxialPos);const o=new Laya.Vector3(s.x,i.transform.localPosition.y,s.y);t.moveToTarget(i,o,.04)}setTimeout(()=>{t.Gameplay.afterFight()},450)}}}initEnemy(t,e,a){return this.canHit=!0,this.firstHit=!0,this.createEnemy(a,t,e)}createEnemy(t,e,a){let i=[],s=xt.generateRadiusMap(8);for(let o=0;o<t;o++){let t;for(const[e,a]of s)if(a.length>0){t=a.splice(0,1)[0];break}if(t){let s;(s=x.pool3d.getSign(e.name,!1))||(s=Laya.Sprite3D.instantiate(e,null,!1,new Laya.Vector3(0,0,0))),s.active=!0,i.push(s);let o=xt.axialToWorld(t);s.transform.position=new Laya.Vector3(o.x,0,o.y),a.addChild(s)}else console.error("enemy--no pos")}return s.clear(),s=null,i}calculateDistance(t,e){const a=t.transform.position.x+this.width/2,i=t.transform.position.z+this.height/2,s=e.transform.position.x+this.width/2,o=e.transform.position.z+this.height/2;return Math.sqrt(Math.pow(a-s,2)+Math.pow(i-o,2))}eliminateSoldiers(t,e){const a=new Set,i=new Set;return t.forEach(t=>{if(a.has(t))return;let s=.1,o=null;e.forEach(e=>{if(i.has(e))return;let a={x:t.transform.position.x,y:t.transform.position.z,width:this.width,height:this.height},n={x:e.transform.position.x,y:e.transform.position.z,width:this.width,height:this.height};if(Tt.isRectCollision(a,n)){const a=this.calculateDistance(t,e);a<s&&(s=a,o=e)}}),o&&(a.add(t),i.add(o))}),[Array.from(a),Array.from(i)]}moveToTarget(t,e,a=.02){let i=0;const s=new Laya.Vector3(t.transform.position.x,t.transform.position.y,t.transform.position.z);let o=(n=!1)=>{if(!t)return Laya.timer.clear(this,o),!0;if(t.destroyed)return Laya.timer.clear(this,o),!0;if(n&&(i=1),!(i<1))return Laya.timer.clear(this,o),console.log("移动完成"),t.transform.position=s,t.parent.playAni&&(t.parent.playAni=null),!0;{i+=a;let o=new Laya.Vector3;Laya.Vector3.lerp(s,e,i,o),t.transform.position=o}return!1};Laya.timer.frameLoop(1,this,o)}}class Mt extends Rt{constructor(){super(),this.canHit=!0,this.hitObject="roleBox"}isOnCollision(t){this.canHit&&(this.canHit=!1,t.Gameplay.GameWin())}changeTotal(){}damageOne(){}}class Vt extends Rt{constructor(){super(),this.canHit=!0,this.hitObject="roleBox"}isOnCollision(t,e){this.canHit&&(this.canHit=!1,t.Gameplay.isNormal=!1,t.Gameplay.changeHorror())}}class Nt extends Rt{constructor(){super(),this.canHit=!0,this.hitObject="roleIns",this.soundCd=0,this.array=[]}isItemOnCollision(t,e,a){if(this.canHit&&t.canHitSelf&&!t.isJumping)return this.playJumpSound(),t.canHitSelf=!1,t.isJumping=!0,t.jumpT=0,this.array.push(t),!1}playJumpSound(){this.soundCd<=0&&(x.audio.playSound("sound/Player Jumps.mp3"),this.soundCd=1e3)}updateJump(t){t.jumpT+=.1;let e=.35*t.jumpT-.05*t.jumpT*t.jumpT;if(e<=0){e=0,t.isJumping=!1,t.canHitSelf=!0;let a=Bt.findIndex(this.array,t);this.array.splice(a,1)}let a=e-t.roleIns.transform.position.y;t.roleIns.transform.translate(new Laya.Vector3(0,a,0))}onUpdate(){this.soundCd>0&&(this.soundCd-=Laya.timer.delta);for(let t=this.array.length-1;t>=0;t--){let e=this.array[t];this.updateJump(e)}}quadraticBezier(t,e,a,i){let s=1-i,o=i*i,n=s*s,r=new Laya.Vector2;return r.x=n*t.x+2*s*i*e.x+o*a.x,r.y=n*t.y+2*s*i*e.y+o*a.y,r}}class Ot extends Laya.Script{constructor(){super(),this.cameraRunPos=new Laya.Vector3(0,1.4,-.3),this.cameraIdlePos=new Laya.Vector3(0,.8,-.3)}initCamera(t){this.gameplay=t,this.cameraOffset=void 0,this.cameraRota||(this.cameraRota=new Laya.Vector3(this.owner.transform.localRotationEuler.x,this.owner.transform.localRotationEuler.y,this.owner.transform.localRotationEuler.z),this.cameraRotaGround=new Laya.Vector3(this.cameraRota.x+20,this.cameraRota.y,this.cameraRota.z))}changeHorrColor(){this.owner.clearColor=g.hexToRGBA("#5F0887",1)}resetCamera(){this.owner.clearColor=g.hexToRGBA("#02ACFF",1),this.owner.msaa=!0,this.owner.transform.position=this.cameraRunPos,this.owner.transform.localRotationEuler=new Laya.Vector3(this.cameraRotaGround.x,this.cameraRotaGround.y,this.cameraRotaGround.z),this.owner.transform.position=new Laya.Vector3(this.cameraIdlePos.x,this.cameraIdlePos.y,this.cameraIdlePos.z)}onUpdate(){if(!this.gameplay.gameStart)return;null==this.cameraOffset&&(this.cameraOffset=this.gameplay.roleBox.transform.position.z-this.owner.transform.position.z);const t=this.owner.transform.position.x,e=this.owner.transform.position.y;0!=this.gameplay.runSpeed&&(this.owner.transform.position=new Laya.Vector3(t,e,this.gameplay.roleBox.transform.position.z-this.cameraOffset))}moveToLow(t){this.moveCamera(this.cameraRotaGround,this.cameraIdlePos,()=>{t&&t()})}moveToStart(){this.moveCamera(this.cameraRota,this.cameraRunPos,()=>{})}moveCamera(t,e,a,i=.045){let s=0;const o=new Laya.Vector3(this.owner.transform.localRotationEuler.x,this.owner.transform.localRotationEuler.y,this.owner.transform.localRotationEuler.z);let n=void 0;e&&(n=e.y-this.owner.transform.position.y);let r=()=>{if(!(s<1))return Laya.timer.clear(this,r),console.log("移动完成"),a&&a(),!0;{s+=i;let e=new Laya.Vector3;if(Laya.Vector3.lerp(o,t,s,e),this.owner.transform.localRotationEuler=e,null!=n){let t=n*s-n*(s-i);this.owner.transform.translate(new Laya.Vector3(0,t,0))}}return!1};Laya.timer.frameLoop(1,this,r)}}class Ht extends Rt{constructor(){super(),this.canHit=!0,this.hitObject="roleBox"}isOnCollision(t){if(this.canHit){this.canHit=!1;let e=()=>{t.Gameplay.passSpeed()};t.Gameplay.camera.getComponent(Ot).moveToLow(e)}}}class Gt extends Rt{constructor(){super(),this.canHit=!0,this.hitObject="roleBox",this.moveFun=[],this.number3Pos=[.09,0,-.09],this.number2Pos=[.05,-.05]}isOnCollision(t,e){if(this.canHit){let a=e.insList[0];if(!a)return;for(let e=a.numChildren-1;e>=0;e--){let i=a.getChildAt(e),s={x:0,y:t.calculateCenter().y,width:1,height:1},o={x:i.transform.position.x,y:i.transform.position.z,width:1,height:.15};if(Tt.isRectCollision(s,o)){if(i.playAni)continue;i.playAni=1;let t=i.getChildAt(0),e=i.getChildAt(1);const a=new Laya.Vector3(t.transform.localPosition.x-1,t.transform.localPosition.y+.8,t.transform.localPosition.z-1),s=new Laya.Vector3(e.transform.localPosition.x+1,e.transform.localPosition.y+.8,e.transform.localPosition.z-1);this.moveToTarget(t,a,.03),this.moveToTarget(e,s,.03);let o=i.getChildByName("numberNode");o&&o.destroy()}}}}onUpdate(){this.updateMoveLefp()}updateMoveLefp(){for(let t=this.moveFun.length-1;t>=0;t--){let e=this.moveFun[t];if(e){e()&&this.moveFun.splice(t,1),e=null}}}moveToTarget(t,e,a=.02){let i=0;const s=new Laya.Vector3(t.transform.localPosition.x,t.transform.localPosition.y,t.transform.localPosition.z);this.moveFun.push((o=!1)=>{if(o&&(i=1),!(i<1))return console.log("移动完成"),t.transform.localPosition=s,t.parent.playAni&&(t.parent.playAni=null),!0;{i+=a;let o=new Laya.Vector3;Laya.Vector3.lerp(s,e,i,o),t.transform.localPosition=o}return!1})}initNumber(t){for(let e=0;e<t.numChildren;e++){const a=t.getChildAt(e),i=a.name.match(/\d+/g);if(i){let e=t.getChildByName("numberNode");e&&e.destroy();let s=new Laya.Sprite3D("numberNode");e=a.addChild(s);let o=(31-i.map(Number)[0]).toString().split(""),n=[];n.unshift("UI_Game/Num_H.png");for(let t=0;t<o.length;t++){let e="UI_Game/Num_"+o[t]+".png";n.unshift(e)}for(let t=0;t<n.length;t++){let a="3dAssest/LayaScene_RoleExport/Conventional/prefab_numer.lh",i=Laya.Sprite3D.instantiate(Laya.Loader.getRes(a));e.addChild(i);let s=n.length<3?this.number2Pos:this.number3Pos,o=n[t];Laya.Texture2D.load(o,Laya.Handler.create(null,e=>{let a=i.meshRenderer;if(a&&a.material){let o=a.material,n=e;n&&(o.albedoTexture=n,i.transform.localPosition=new Laya.Vector3(s[t],.1,.01),i.transform.localRotationEuler=new Laya.Vector3(0,0,0),i.transform.localScale=new Laya.Vector3(1.2,1.2,1.2))}}))}}else console.log("No numbers found in the string.")}}onDisable(){for(let t=0;t<this.moveFun.length;t++){let e=this.moveFun[t];e&&e(!0)}}}class Ut extends Pt{constructor(){super(),this.canHit=!0,this.hitObject="roleBox"}isOnCollision(t){if(this.canHit){this.canHit=!1,x.audio.playSound("sound/OBSTACLE_BUTTON_ACTIVATE.mp3"),this.count=2;let e=this.count*t.characters.length-t.characters.length;t.addCharacter(e)}}}class zt extends Rt{constructor(){super(),this.canHit=!0,this.hitObject="roleBox",this.firstHit=!0,this.shootCD=0,this.hp=15,this.arrowQueue=[],this.width=.1,this.height=.1}onDisable(){}onUpdate(){this.shootCD>0&&(this.shootCD-=Laya.timer.delta);for(let t=0;t<this.arrowQueue.length;t++){this.arrowQueue[t]}}shootThat(t,e){if(!(this.shootCD>0)){this.shootCD=500;for(let a=1;a<=3;a++){let i=g.findChild("block_archer_"+a,e);if(i){let e="3dAssest/LayaScene_RoleExport/Conventional/prefab_arrow.lh",a=Laya.Sprite3D.instantiate(Laya.Loader.getRes(e));const s=new Laya.Vector3(i.transform.position.x,i.transform.position.y,i.transform.position.z-.03);t.Gameplay.gameScene.addChild(a),this.arrowQueue.push(a),a.transform.position=s;let o=t.calculateCenter();this.moveToTarget(a,new Laya.Vector3(s.x,0,o.y),.1)}}}}isOnCollision(t,e){if(this.canHit){this.shootThat(t,e.insList[0]);let a=[];for(let e=0;e<t.characters.length;e++){const i=t.characters[e];a.push(i.roleIns)}const i=this.eliminateSoldiers([e.parentNode],a);for(let e=i.length-1;e>=0;e--){let a=i[e];for(let e=0;e<t.characters.length;e++){let i=t.characters[e];if(i.roleIns==a){t.Gameplay.recoverRole(i),i=null,t.characters[e]=null,t.characters.splice(e,1);break}}a=null}}}initEnemy(t,e,a){return this.canHit=!0,this.firstHit=!0,this.createEnemy(a,t,e)}createEnemy(t,e,a){let i=[],s=xt.generateRadiusMap(8);for(let o=0;o<t;o++){let t;for(const[e,a]of s)if(a.length>0){t=a.splice(0,1)[0];break}if(t){let s;(s=x.pool3d.getSign(e.name,!1))||(s=Laya.Sprite3D.instantiate(e,null,!1,new Laya.Vector3(0,0,0))),s.active=!0,i.push(s);let o=xt.axialToWorld(t);s.transform.position=new Laya.Vector3(o.x,0,o.y),a.addChild(s)}else console.error("enemy--no pos")}return s.clear(),s=null,i}calculateDistance(t,e){const a=t.transform.position.x+this.width/2,i=t.transform.position.z+this.height/2,s=e.transform.position.x+this.width/2,o=e.transform.position.z+this.height/2;return Math.sqrt(Math.pow(a-s,2)+Math.pow(i-o,2))}eliminateSoldiers(t,e){const a=new Set,i=new Set;return t.forEach(t=>{if(a.has(t))return;let s=.1,o=null;e.forEach(e=>{if(i.has(e))return;let a={x:t.transform.position.x,y:t.transform.position.z,width:this.width,height:this.height},n={x:e.transform.position.x,y:e.transform.position.z,width:this.width,height:this.height};if(Tt.isRectCollision(a,n)){const a=this.calculateDistance(t,e);a<s&&(s=a,o=e)}}),o&&i.add(o)}),Array.from(i)}onDestroy(){for(let t=this.arrowQueue.length-1;t>=0;t--){this.arrowQueue[t].destroy()}}moveToTarget(t,e,a=.02){let i=0;const s=new Laya.Vector3(t.transform.position.x,t.transform.position.y,t.transform.position.z);let o=(n=!1)=>{if(!t)return Laya.timer.clear(this,o),!0;if(t.destroyed)return Laya.timer.clear(this,o),!0;if(n&&(i=1),!(i<1))return Laya.timer.clear(this,o),console.log("移动完成"),t.transform.position=s,!0;{i+=a;let o=new Laya.Vector3;Laya.Vector3.lerp(s,e,i,o),o||console.error("!!11!"),t||console.error("!22!!"),t.transform||console.error("!33!!"),t.transform.position=o}return!1};Laya.timer.frameLoop(1,this,o)}}class Wt extends Laya.Script{constructor(){super(),this.roadQueue=[],this.runSpeed=0,this.defaultRunSpeed=.0115,this.maxRoadLong=25,this.gameStart=!1,this.gameConfig=null,this.stopHand=!1,this.isNormal=!1,this.propIndex=0,this.enemyIndex=0,this.hasShowWarning=!1,this.nameSize=.5,this.GetLengthFromName=(t=>{let e=t.lastIndexOf("_");if(e>=0&&e<t.length-1){let a=t.substring(e+1),i=parseInt(a);return i||1}})}onAwake(){this.loadScene()}onEnable(){}onStart(){x.dialog.open(pt.HomeDialog,!1,this),this.restart()}initWave(){this.loadWaveData();(()=>{let t=new Laya.Sprite3D("_RoleBox_");this.roleBox=this.gameScene.addChild(t),this.roleBox.transform.position=new Laya.Vector3(0,0,.7);let e=Laya.Loader.getRes("3dAssest/LayaScene_RoleExport/Conventional/prefab_role.lh"),a=this.roleBox.addComponent(Dt);a.Gameplay=this,a.initCharactersMgr(e)})()}playMusic(){let t=["BGM_Music_normal_2","BGM_Music_normal_1"][Math.floor(Math.random()+1)];x.audio.playMusic("sound/"+t+".mp3")}resetGameScene(){if(this.runSpeed=this.defaultRunSpeed,this.camera&&this.camera.getComponent(Ot).resetCamera(),this.roadQueue.length>0){for(let t=0;t<this.roadQueue.length;t++){let e=this.roadQueue[t];this.recoverRoad_block(e),this.roadQueue[t]=null}this.roadQueue=[]}if(this.roleBox&&this.roleBox.getComponent(Dt)){let t=this.roleBox.getComponent(Dt);for(let e=0;e<t.characters.length;e++){let a=t.characters[e];this.recoverRole(a),t.characters[e]=null,a=null}t.characters=[]}let t=this.gameScene.getChildByName("_RoadBox_");t&&t.destroy();let e=this.gameScene.getChildByName("_RoleBox_");e&&e.destroy(),this.warning.visible=!1,this.hasShowWarning=!1,this.skyTop.skin="UI_Game/bg_fog_normal.png",this.maskRect.active=!0}restart(){this.resetGameScene(),this.initGame(),this.initWave()}loadWaveData(){let t=Lt.gameData.getWaveById(gt.baseData._baseData.waveID);this.gameConfig=t,Laya.loader.load(t.mapUrl,Laya.Handler.create(this,()=>{let e=Laya.loader.getRes(t.mapUrl);console.log("加载成功:",e.levelData);let a=e.levelData;this.levelData=Bt.deepClone(a),this.loadRoad_Block()}))}loadRoad_Block(){let t=[];for(let e=0;e<this.levelData.length;e++){const a=this.levelData[e];let i=a.roadName;if(a.anchors&&a.anchors.length>0)for(let e=0;e<a.anchors.length;e++){let i={url:"3dAssest/LayaScene_RoleExport/Conventional/"+a.anchors[e].childNames+".lh",type:Laya.Loader.HIERARCHY};t.push(i)}let s={url:"3dAssest/LayaScene_RoleExport/Conventional/"+i+".lh",type:Laya.Loader.HIERARCHY};t.push(s);let o={url:"3dAssest/LayaScene_RoleExport/Conventional/prefab_numer.lh",type:Laya.Loader.HIERARCHY};t.push(o)}t=Bt.unique(t),Laya.loader.create(t,Laya.Handler.create(this,t=>{this.initRoadFirst()}),null,Laya.Loader.HIERARCHY)}clickStartGame(){this.gameStart=!0,this.maskRect.active=!1,this.camera.getComponent(Ot).moveToStart();let t=this.roleBox.getComponent(Dt);t.changeParentNode(),t.playMoveAni(),this.playMusic()}onUpdate(){this.gameStart&&(this.roleBox.transform.translate(new Laya.Vector3(0,0,this.runSpeed)),this.checkRecoverRoadBlock(),this.checkHitRange())}initGame(){this.isNormal=!0,this.propIndex=0,this.enemyIndex=0,this.gameStart=!1,this.stopHand=!1}initRoadFirst(){let t=new Laya.Sprite3D("_RoadBox_");this.roadBox=this.gameScene.addChild(t),this.roadBox.transform.position=new Laya.Vector3(0,0,0),this.birthRoadBlock()}birthRoadBlock(){if(!(this.roadQueue.length>=this.maxRoadLong))for(let t=0,e=this.levelData.length;t<e;t++){let t,e=this.levelData.splice(0,1)[0],a=e.roadName,i="3dAssest/LayaScene_RoleExport/Conventional/"+a+".lh";(t=x.pool3d.getSign(a,!1))||(t=Laya.Sprite3D.instantiate(Laya.Loader.getRes(i)));let s=1,o=0;if(this.roadQueue.length>0){let t=this.roadQueue[this.roadQueue.length-1].roadIns,e=this.GetLengthFromName(t.name);o=t.transform.localPosition.z+s*e*this.nameSize}else o=0;this.changeRoadTex(t,t.name),t.active=!0,t.transform.localPosition=new Laya.Vector3(0,0,o),this.roadBox.addChild(t);let n=new St;if(n.roadIns=t,n.dataBase=e,this.roadQueue.push(n),e.anchors&&e.anchors.length>0){let a=0,i=0;for(let s=0;s<e.anchors.length;s++){let o=e.anchors[s].anchorName,r=e.anchors[s].childNames[0],l="3dAssest/LayaScene_RoleExport/Conventional/"+r+".lh",h=t=>{let e;if(!(e=x.pool3d.getSign(r,!1))){Laya.Loader.getRes(l)||console.error(l,"cannotFind"),e=Laya.Sprite3D.instantiate(Laya.Loader.getRes(l))}e.active=!0,t.addChild(e),e.transform.position=new Laya.Vector3(0,0,0),e.transform.localPosition=new Laya.Vector3(0,0,0);let a=new It;a.parentNode=t,a.insList.push(e),n.blockDataList.push(a);for(let t=0;t<a.insList.length;t++){const e=a.insList[t];e&&this.changeBlockTex(e,e.name)}return e},d=new Laya.Sprite3D("box_b");if(d.transform.localPosition=new Laya.Vector3(0,0,0),t.getChildByName(o).addChild(d),-1!=r.indexOf("block_enemy")){i+=1;let t=this.gameConfig.propList[this.enemyIndex],e=Lt.gameData.getEnemyCfgByID(t),a=Math.floor(Math.random()+1),s=5;e&&(s=e.count[a]);let o=new It;o.parentNode=d,n.blockDataList.push(o);let r=d.addComponent(Et).initEnemy(Laya.Loader.getRes(l),d,s);o.insList=r;for(let t=0;t<r.length;t++){const e=r[t];this.changeBlockTex(e,e.name)}}else if(-1!=r.indexOf("block_tower"))d.addComponent(zt),h(d);else if(-1!=r.indexOf("block_prop")&&-1==r.indexOf("block_propHat")){a+=1;let t=d.addComponent(Pt),e=h(d),i=this.gameConfig.propList[this.propIndex],s=Lt.gameData.getPropCfgById(i);t.bindRoad=n,t.initNumber(e,s,a)}else if(-1!=r.indexOf("block_propHat"))d.addComponent(Vt),h(d);else if(-1!=r.indexOf("block_jump"))d.addComponent(Nt),h(d);else if(-1!=r.indexOf("block_winLine"))d.addComponent(Ht),h(d);else if(-1!=r.indexOf("block_bonus")){let t=d.addComponent(Ut),e=h(d),a=Lt.gameData.getPropCfgById(12);t.initNumber(e,a,1)}else if(-1!=r.indexOf("block_boss"))d.addComponent(Mt),h(d);else if(-1!=r.indexOf("block_rainbow")){let t=d.addComponent(Gt),e=h(d);t.initNumber(e)}else d.addComponent(Rt),h(d)}a>0&&(this.propIndex+=1),i>0&&(this.enemyIndex+=1)}if(this.roadQueue.length>=this.maxRoadLong)break}}changeHorror(){for(let t=0;t<this.roadQueue.length;t++){const e=this.roadQueue[t];this.changeRoadTex(e.roadIns,e.dataBase.roadName);let a=e.blockDataList;for(let t=0;t<a.length;t++){const e=a[t];e.insList;for(let t=0;t<e.insList.length;t++){const a=e.insList[t];this.changeBlockTex(a,a.name)}}}this.skyTop.skin="UI_Game/bg_fog_horror.png",this.camera.getComponent(Ot).changeHorrColor()}changeBlockTex(t,e,a=this.isNormal){let i,s=Lt.gameData.getBlockCfgByName(e);(i=a?s.textureUrl:s.kbUrl)&&(i="UI_Game/"+i+".png",this.changeTexture(t,"changeNode",i))}changeRoadTex(t,e,a=0,i=this.isNormal){let s,o=Lt.gameData.getRoadCfgByName(e);if(o&&(s=i?o.textureUrl[a]:o.kbUrl)){s="UI_Game/"+s+".png";for(let e=0;e<o.changeNode.length;e++){const a=o.changeNode[e];this.changeTexture(t,a,s)}}}changeTexture(t,e,a){let i=g.findChild(e,t);Laya.Texture2D.load(a,Laya.Handler.create(null,s=>{i||console.error(t,e,a);let o=i.meshRenderer;if(o&&o.material&&s){o.material.albedoTexture=s}}))}checkRecoverRoadBlock(){for(let t=0;t<this.roadQueue.length;t++){let e=this.roadQueue[t],a=e.roadIns.transform.position.z,i=this.roleBox.transform.position.z,s=2*this.GetLengthFromName(e.dataBase.roadName)*this.nameSize;i-a>s&&(console.log("outside",s,e.dataBase.roadName),this.recoverRoad_block(e),this.roadQueue[t]=null)}for(let t=this.roadQueue.length-1;t>=0;t--){this.roadQueue[t]||this.roadQueue.splice(t,1)}this.birthRoadBlock()}loadScene(){const t=Laya.loader.getRes("3dAssest/LayaScene_GameScene/Conventional/GameScene.ls");if(x.initPool3d(t),this.owner.addChildAt(t,0),this.gameScene=t,console.log(t),this.camera=t.getChildByName("CAMERA"),this.camera){this.camera.addComponent(Ot).initCamera(this)}else console.error("未找到相机");this.maskRect=t.getChildByName("MASK"),this.maskRect?this.idlePos=this.maskRect.getChildAt(0):console.error("未找到遮罩")}checkRoleCount(){this.roleBox.numChildren>0&&console.log("角色数量：",this.roleBox.numChildren)}checkHitRange(){for(let t=0;t<this.roadQueue.length;t++){let e=this.roadQueue[t],a=e.roadIns.transform.position.z,i=this.GetLengthFromName(e.dataBase.roadName),s=this.nameSize*i,o=this.roleBox.transform.position.z,n=this.roleBox.getComponent(Dt),r={x:0,y:o,width:n.curRange[0],height:n.curRange[1]},l={x:0,y:a,width:1,height:s+1};-1!=e.roadIns.name.indexOf("rainbow")&&(l={x:0,y:a+s/2,width:1,height:s+1});let h=Tt.isRectCollision(r,l);if(e.dataBase.roadName,h){let t=e.blockDataList,a=this.roleBox.getComponent(Dt);for(let e=0;e<t.length;e++){const i=t[e];let s=i.insList[0];if(!s){console.log("没障碍");continue}let o=Lt.gameData.getBlockCfgByName(s.name);if(!o){console.warn("没配置");continue}"block_propHat"==o.name&&(this.hasShowWarning||(this.hasShowWarning=!0,this.warning.visible=!0,this.owner.addChild(this.warning),Laya.timer.once(2e3,this,()=>{this.warning.visible=!1})));let n=o.hitRange,r={x:i.parentNode.transform.position.x,y:i.parentNode.transform.position.z,width:n[0],height:n[1]};if("block_rainbow"==o.name&&(r={x:i.parentNode.transform.position.x,y:i.parentNode.transform.position.z+n[1]/2,width:n[0],height:n[1]}),i.parentNode.getComponent(Rt)){let t=i.parentNode.getComponent(Rt);if("roleBox"==t.hitObject&&t.canHit){let e=a.calculateCenter(),o={x:e.x,y:e.y,width:a.prefab_wid,height:a.prefab_wid};Tt.isRectCollision(r,o)&&(console.log("===hit===",s.name),t.isOnCollision(a,i))}else if("roleIns"==t.hitObject&&t.canHit){let e=!1;for(let i=a.characters.length-1;i>=0;i--){let s={x:a.characters[i].roleIns.transform.position.x,y:a.characters[i].roleIns.transform.position.z,width:a.prefab_wid,height:a.prefab_wid};Tt.isRectCollision(r,s)&&(e=t.isItemOnCollision(a.characters[i],a,this))}e&&Laya.timer.once(.5,this,()=>{this.roleBox.getComponent(Dt).moveToCenter()})}}}}}}GameWin(){let e=Lt.gameData.getPassRewardByWaveID(gt.baseData._baseData.waveID),a=e&&e.role?e.role:0,i=e.coin?e.coin:100;i+=200*(gt.baseData._baseData.lvEarn-1),gt.baseData._baseData.coin+=i,gt.baseData.save(),x.event(t.coin_change),Lt.gameData.passWave(),this.gameStart=!1,x.dialog.open(pt.EndDialog,!0,[this,!0,i,a])}GameOver(){this.gameStart=!1,x.dialog.open(pt.EndDialog,!0,[this,!1])}recoverRoad_block(t){let e=t.blockDataList;for(let t=0;t<e.length;t++){let a=e[t];for(let t=0;t<a.insList.length;t++){let e=a.insList[t];e.removeSelf(),e.destroy(),a.insList[t]=null,e=null}a.parentNode.removeSelf().destroy()}e=null,x.pool3d.recover(t.roadIns.name,t.roadIns),t.blockDataList=null,t.roadIns=null,t.dataBase=null,t=null}recoverRole(t){this.playEffectDead(t.roleIns),this.roleBox.getComponent(Dt).characterAxialMap.get(t.keyAxial).push(t.AxialPos),x.pool3d.recover(t.roleIns.name,t.roleIns),t.AxialPos=null,t.keyAxial=null,t.roleIns=null,t=null}playEffectDead(t){x.audio.playSound("sound/COLLECT_HUMANS.mp3");let e=Laya.Loader.getRes("3dAssest/LayaScene_RoleExport/Conventional/effect_dead.lh"),a=Laya.Sprite3D.instantiate(e);this.roleBox.addChild(a),a.transform.position=new Laya.Vector3(t.transform.position.x,t.transform.position.y+.1,t.transform.position.z);let i=a.getChildAt(0);i&&(i.particleSystem.play(),Laya.timer.once(500,this,()=>{a.destroy()}))}stopToFight(){this.runSpeed=0,this.stopHand=!0}resumeSpeed(){this.runSpeed=this.defaultRunSpeed}passSpeed(){this.runSpeed=.0385}afterFight(){this.resumeSpeed(),this.stopHand=!1}checkRoadFallDown(){}freshCountTag(t,e){if(this.gameStart){this.countBox.visible=!0,this.countBox.pos(t.x,t.y-167),this.countBox.getChildAt(0).text=e+""}else this.countBox.visible=!1}}class Ft extends Laya.Script{constructor(){super(),this.timeLine=new Laya.TimeLine,this.angle=15,this.waitDuration=1e3,this.shakeDuration=800}onAwake(){let t=this.owner.rotation;this.timeLine.to(this.owner,{rotation:t-this.angle},this.shakeDuration/8,null,this.waitDuration).to(this.owner,{rotation:t+this.angle},this.shakeDuration/4).to(this.owner,{rotation:t-this.angle},this.shakeDuration/4).to(this.owner,{rotation:t+this.angle},this.shakeDuration/4).to(this.owner,{rotation:t},this.shakeDuration/8)}onEnable(){this.timeLine.play(0,!0)}}class qt extends Laya.Script{constructor(){super()}onCreated(t){}onAwake(){let t=Laya.stage.height-this.owner.height;this.owner.height=Laya.stage.height,this.owner.y-=t/2}}class Yt{static random(t=0,e=1){return Math.random()*(e-t)+t}static randomInt(t=0,e=1){return Math.round(this.random(t,e))}static randomBool(){return Math.random()>.5}static lerp(t,e,a){return t+(e-t)*a}static lerpInt(t,e,a){let i=this.lerp(t,e,a);return i=e>t?Math.ceil(i):Math.floor(i)}static roundFixed(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)}static toStrPadding(t,e,a="0"){let i=e-(Math.floor(t)+"").length,s=t+"";for(;i>0;)s=a+s,i--;return s}}class Xt extends qt{constructor(){super(),this.bar=null,this.skBox=null,this.total=4,this.complete=0,this.barWidth=600,this.loadProgress=0}get bar_progress(){return this.bar.width/this.barWidth}set bar_progress(t){t<0?t=0:t>1&&(t=1),this.bar.width=t*this.barWidth}onAwake(){this.loadSpine()}onEnable(){return __awaiter(this,void 0,void 0,function*(){Laya.loader.create(["data.json","3dAssest/LayaScene_GameScene/Conventional/GameScene.ls","3dAssest/LayaScene_RoleExport/Conventional/effect_whiteBoom.lh","3dAssest/LayaScene_RoleExport/Conventional/effect_orangeBoom.lh","3dAssest/LayaScene_RoleExport/Conventional/effect_dead.lh","3dAssest/LayaScene_RoleExport/Conventional/prefab_role.lh","3dAssest/LayaScene_RoleExport/Conventional/road_2.lh","3dAssest/LayaScene_RoleExport/Conventional/block_winLine.lh","3dAssest/LayaScene_RoleExport/Conventional/block_rainbow.lh","3dAssest/LayaScene_RoleExport/Conventional/block_prop.lh","3dAssest/LayaScene_RoleExport/Conventional/prefab_arrow.lh","3dAssest/LayaScene_RoleExport/Conventional/prefab_gray.lh"],Laya.Handler.create(this,()=>{gt.init();let t=Laya.loader.getRes("data.json");console.log("加载成功:",t),Lt.init(t)}),Laya.Handler.create(this,t=>{console.log(t,"progress"),this.loadProgress=t,this.onComplete()}))})}onUpdate(){let t=this.loadProgress;t<this.bar_progress?this.bar_progress=t:this.bar_progress=Yt.lerp(this.bar_progress,this.loadProgress,.01)}onComplete(){return __awaiter(this,void 0,void 0,function*(){if(this.loadProgress<1)return;this.bar_progress=1;let t=Laya.timer.currTimer;console.log("资源加载完成",t),this.goToGame()})}goToGame(){x.view.open(pt.GameUI,!0,{},Laya.Handler.create(this,()=>{}))}loadSpine(){let t=new Laya.Skeleton;t.scale(.7,.7),t.pos(0,0),t.load("UI_Load/ani/jzy.sk"),this.skBox.addChild(t)}}class jt extends Laya.Script{constructor(){super(),this.timeLine=new Laya.TimeLine,this.minScale=1,this.maxScale=1.2,this.toMaxDuration=1e3,this.toMinDuration=1e3,this.status=!0}onAwake(){let t=this.owner.scaleX,e=this.owner.scaleY;this.timeLine.to(this.owner,{scaleX:t*this.maxScale,scaleY:e*this.maxScale},this.toMaxDuration).to(this.owner,{scaleX:t*this.minScale,scaleY:e*this.minScale},this.toMinDuration)}onEnable(){this.timeLine.play(0,!0),this.status||this.pause()}resume(){this.timeLine.resume()}pause(){this.timeLine.pause()}}class Jt{constructor(){}static init(){var t=Laya.ClassUtils.regClass;t("script/view/CoinItem.ts",mt),t("script/dialog/EndDialog.ts",bt),t("script/dialog/HomeDialog.ts",At),t("script/dialog/SetDialog.ts",kt),t("script/view/GameUI.ts",Wt),t("framework/prefab/TweenShake.ts",Ft),t("script/view/LoadView.ts",Xt),t("framework/prefab/TweenScale.ts",jt)}}Jt.width=750,Jt.height=1334,Jt.scaleMode="fixedwidth",Jt.screenMode="none",Jt.alignV="top",Jt.alignH="left",Jt.startScene="gameui/scene/LoadView.scene",Jt.sceneRoot="",Jt.debug=!1,Jt.stat=!0,Jt.physicsDebug=!1,Jt.exportSceneToJson=!0,Jt.init();let $t=(()=>{class t{constructor(t,e){this.runtime=e,this.data={sid:t.slotId},this.ad=t.createAd(t.params),this.ad.onError(t=>{})}load(){return this.ad.load()}show(){const t=this;return this.ad.show().then(()=>{t.runtime.event("ad","imp",{lbl:t.data.stype,val:0,sub5:t.data.sid})},t=>{throw t})}destroy(){this.ad.destroy()}onClose(t){this.ad.onClose(t)}offClose(t){this.ad.offClose(t)}onLoad(t){this.ad.onLoad(t)}offLoad(t){this.ad.offLoad(t)}onError(t){this.ad.onError(t)}offError(t){this.ad.offError(t)}}class e extends t{constructor(t,e){super(t,e),this.data.stype="banner",this.showed=!1}show(){const t=this;return this.ad.show().then(()=>{t.showed||(t.showed=!0,t.runtime.event("ad","imp",{lbl:t.data.stype,val:0,sub5:t.data.sid}))},t=>{throw t})}hide(){this.ad.hide()}offResize(t){this.ad.offResize(t)}onResize(t){this.ad.onResize(t)}}class a extends t{constructor(t,e){super(t,e),this.data.stype="interstitial"}}class i extends t{constructor(t,e){super(t,e),this.data.stype="video",this.adUnitId=t.adUnitId,this.onCloseCallbacks=[],this.onLoadCallbacks=[],this.onErrorCallbacks=[]}load(){const t=this;return this.ad.offError(),this.ad.onError(e=>{for(const a of t.onErrorCallbacks)a(e)}),this.ad.offLoad(),this.ad.onLoad(()=>{for(const e of t.onLoadCallbacks)e()}),this.ad.load()}show(){const t=this;return this.ad.offClose(),this.ad.onClose(e=>{(e&&e.isEnded||void 0===e)&&t.runtime.event("ad","imp",{lbl:t.data.stype,val:0,sub5:t.data.sid});for(const a of t.onCloseCallbacks)a(e)}),this.ad.show()}onClose(t){this.onCloseCallbacks.push(t)}onLoad(t){this.onLoadCallbacks.push(t),this.ad.offLoad(),this.ad.onLoad(t)}onError(t){this.onErrorCallbacks.push(t),this.ad.offError(),this.ad.onError(e=>{t(e)})}}class s extends t{constructor(t,e){super(t,e),this.data.stype="native"}}class o extends t{constructor(t,e){super(t,e),this.data.stype="grid"}}function c(t,e){if(!t){const e=(t=window.location.search).indexOf("?");-1!=e&&(t=t.substr(e+1))}const a={},i=t.split(e||"&");for(let t=0;t<i.length;t++){if(!i[t])continue;const e=i[t].split("=");a[e[0].trim()]=decodeURIComponent(e[1].trim())}return a}function u(t,e){const a=[];for(const e in t)t[e]&&a.push(e+"="+encodeURIComponent(t[e]));return a.join(e||"&")}function l(t){let e="";const a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let i=0;i<t;i++)e+=a.charAt(Math.floor(Math.random()*a.length));return e}function h(t,e){for(const a in t)"__proto__"!=a&&t[a]&&(e[a]=t[a]);return e}function m(t,e,a,i){return new Promise(function(s,o){var n;n={url:e,method:t,header:a,data:i,success:function(t){200==t.statusCode?s(t.data):o(Error(t.statusCode))},fail:function(t){o(t)}},wx.request(n)})}var n=new class{get(t,e){return m("GET",t,e).catch(function(a){if("request:fail timeout"==a.errMsg)return m("GET",t,e);throw a})}post(t,e,a){return m("POST",t,e,a).catch(function(i){if("request:fail timeout"==i.errMsg)return m("POST",t,e,a);throw i})}put(t,e,a){return m("PUT",t,e,a).catch(function(i){if("request:fail timeout"==i.errMsg)return m("PUT",t,e,a);throw i})}delete(t,e,a){return m("DELETE",t,e,a).catch(function(i){if("request:fail timeout"==i.errMsg)return m("DELETE",t,e,a);throw i})}};function p(t){wx.login(t)}function g(t){wx.getStorage(t)}function w(t){wx.setStorage(t)}function b(t){wx.onShareAppMessage(t)}function y(t){wx.shareAppMessage(t)}class r extends e{constructor(t,e){t.createAd=wx.createBannerAd,t.params={adUnitId:t.adUnitId,adIntervals:t.adIntervals,style:t.style},super(t,e),this.style=this.ad.style}}class d extends a{constructor(t,e){t.createAd=wx.createInterstitialAd,t.params={adUnitId:t.adUnitId},super(t,e)}}class f extends i{constructor(t,e){t.createAd=wx.createRewardedVideoAd,t.params={adUnitId:t.adUnitId,multiton:t.multiton},super(t,e)}}class _ extends s{constructor(t,e){t.createAd=wx.createCustomAd,t.params={adUnitId:t.adUnitId,adIntervals:t.adIntervals,style:t.style},super(t,e)}}class L extends o{constructor(t,e){t.createAd=wx.createGridAd,t.params={adUnitId:t.adUnitId,adIntervals:t.adIntervals,style:t.style,adTheme:t.adTheme,gridCount:t.gridCount},super(t,e)}}class v{constructor(t,e){this.data={},h(t,this.data),this.runtime=e,this.showed=!1}show(t){if(this.showed)return;let e=this.data.impurl,a={};const i=this.data.impurl.indexOf("?");-1!=i&&(e=this.data.impurl.substr(0,i),a=c(this.data.impurl.substr(i+1))),t&&(a.em=t,a.ec=-1),e=e+"?"+u(a),n.get(e),this.showed=!0}click(t){t=t||{},function(t,e){wx.navigateToMiniProgram({appId:t.appid,path:t.path,extraData:e.extraData,envVersion:e.envVersion,success:e.success,fail:e.fail,complete:function(a){let i=t.clkurl,s={};const o=t.clkurl.indexOf("?");-1!=o&&(i=t.clkurl.substr(0,o),s=c(t.clkurl.substr(o+1))),"navigateToMiniProgram:ok"!=a.errMsg&&(s.em=a.errMsg,s.ec=-1),i=i+"?"+u(s),n.get(i),e.complete&&e.complete(a)}})}(this.data,t)}dot(){return this.data.dot}}return new class{init(t){if(this.getSystemInfoPromise=null,this.getSettingPromise=null,this.authPromise=null,this.initPromise=null,this.configPromise=null,this.loginPromise=null,!t.gameId)throw Error("obj.gameId is required by init(obj)");const e=wx.getLaunchOptionsSync();this.data={sdkv:"1.0.3",gid:parseInt(t.gameId),uid:t.uid,unionid:"",uinfo:t.userInfo||{},cid:parseInt(e.query.cid||0),utmsrc:e.query.utmsrc||"",suid:e.query.suid||"",ssid:e.query.ssid||"",smid:parseInt(e.query.smid||0),clue_token:e.query.clue_token||""};const a=this;var i;this.getSystemInfoPromise=new Promise((t,e)=>{new Promise(function(t,e){wx.getSystemInfo({success:function(e){const[a,i]=e.system.split(" "),s={lang:e.language,os:a,osv:i,make:e.brand,model:e.model,width:e.screenWidth,height:e.screenHeight,pv:e.version,plv:e.SDKVersion};e.windowWidth>e.windowHeight?s.o="landscape":s.o="portrait",t(s)},fail:e})}).then(e=>{h(e,a.data),t(e)},e)}),this.getSettingPromise=new Promise((t,e)=>{!function(t){wx.getSetting(t)}({withSubscriptions:!0,success:e=>{const i=(e.subscriptionsSetting||{}).itemSettings||{},s=[];for(const t in i)"accept"==i[t]&&s.push(t);a.data.tids=s,t(e)},fail:e})}),this.authPromise=new Promise((e,i)=>{t.userId?(a.setUserId(t.userId),e({openid:t.userId})):a.login().then(t=>{a.setUserId(t.openid),t.unionid&&a.setUnionId(t.unionid),e(t)},i)}),this.initPromise=Promise.all([this.getSystemInfoPromise,this.getSettingPromise,this.authPromise]).catch(t=>{a.data.err=t.message}).then(()=>n.post("https://gw.api.umgame.cn/api/v1/init",{},a.data).then(t=>{if(0!==t.c)throw Error(t.m);return a.data.inited=1,a.data.cid=t.d.cid,a.data.utmsrc=t.d.utmsrc,a.data.its=t.d.its,a.bald=t.d.bald,a.config=t.d.params||{},a.shareMaterial=t.d.share_material||{},a.shareStats={new:t.d.share_new,exists:t.d.share_old},a.loc={province:t.d.province,city:t.d.city},a.sub_params=t.d.sub_params,!0})).catch(t=>(a.data.inited=0,!1)),this.configPromise=this.initPromise.then(()=>a.config),this.startTime=Date.now(),i=(t=>{a.isShareDialogVisible?a.isShareDialogVisible=!1:a.startTime=Date.now()}),wx.onShow(i),wx.onHide(t=>{if(a.isShareDialogVisible)return;const e=Date.now(),i=parseInt((e-a.startTime)/1e3);a.event("sdk","exit",{val:i})})}login(){const t=this;return this.loginPromise=new Promise((e,a)=>{const i="umsdk:auth:"+t.data.gid,s={success:s=>{if(s.code){const o="https://gw.api.umgame.cn/api/v1/auth?"+u({gid:t.data.gid,code:s.code},"&");n.get(o).then(t=>{0===t.c?w({key:i,data:JSON.stringify(t.d),complete:a=>{e(t.d)}}):a(Error(t.m))}).catch(a)}else a(s)},fail:e=>{a(e),t.loginPromise=null}};g({key:i,success:t=>{const a=JSON.parse(t.data);var i;i={success:()=>{e(a)},fail:()=>{p(s)}},wx.checkSession(i)},fail:t=>{p(s)}})}),this.loginPromise}getUserInfo(){const t=this;return new Promise((e,a)=>{const i="umsdk:userinfo:"+t.data.gid;g({key:i,success:t=>{const a=JSON.parse(t.data);e(a)},fail:s=>{(t.loginPromise||t.login()).then(t=>{var s;s={success:t=>{w({key:i,data:JSON.stringify(t.userInfo),complete:a=>{e(t.userInfo)}})},fail:a},wx.getUserInfo(s)})}})})}setUserId(t){this.data.uid=t}getUserId(){return this.data.uid}setUnionId(t){this.data.unionid=t}getUnionId(){return this.data.unionid}getSetting(){return this.getSettingPromise}loadAttrLib(t,e){if(!t)throw Error("function fn is required by loadAttrLib(fn)");const a=this;this.initPromise.then(function(i){i&&(a.bald&&!e||t())})}fetchConfig(){return this.configPromise}fetchLocation(){const t=this;return this.initPromise.then(function(){return t.loc})}fetchSubParams(){const t=this;return this.initPromise.then(function(){return t.sub_params})}fetchShareData(){const t=this;return this.initPromise.then(function(){return t.shareStats})}fetchLaunchOptions(){const t=this;return this.initPromise.then(function(){return{cid:t.data.cid,src:t.data.utmsrc,its:t.data.its}})}fetchShareQuery(){const t=this;return this.initPromise.then(()=>u({utmsrc:"share",cid:t.data.cid,suid:t.data.uid,smid:t.shareMaterial.smid}))}subscribe(t){const e=this;this.wait4init().then(function(){const a={};h(e.data,a),"subscribeAppMsg:ok"==t.errMsg&&(a.tall=1),t.ids&&(a.tids=t.ids),n.post("https://gw.api.umgame.cn/api/v1/sub",{},a)})}subscribePost(t){const e=this;this.wait4init().then(function(){const a={};h(e.data,a),a.sub_params=t,n.post("https://gw.api.umgame.cn/api/v1/sub/params",{},a)})}GetRankList(t){const e=this;return new Promise((a,i)=>{const s="https://gw.api.umgame.cn/api/v1/query_common_ranking_list?"+u({gid:e.data.gid,type:t.type,top_n:t.top_n,created_at_begin:t.created_at_begin,created_at_end:t.created_at_end,updated_at_begin:t.updated_at_begin,updated_at_end:t.updated_at_end,page:t.page,page_size:t.page_size},"&");n.get(s).then(t=>{0===t.c?a(t.d):i(Error(t.m))}).catch(i)})}SetRank(t){const e=this;this.wait4init().then(function(){h(e.data,t),n.post("https://gw.api.umgame.cn/api/v1/upsert_common_ranking",{},t)})}wait4init(){return this.initPromise}event(t,e,a){if(!t||!e)throw Error("cat and act is required by event(cat, act, params)");const i=this;return this.wait4init().then(function(){const s={app:"minigame",cat:t,act:e,rid:l(16),lang:i.data.lang,os:i.data.os,osv:i.data.osv,make:i.data.make,model:i.data.model,w:i.data.width,h:i.data.height,did:i.data.uid,sub1:i.data.sdkv,sub2:i.data.pv,sub3:i.data.plv,sub4:i.data.utmsrc,subi1:i.data.gid,subi2:i.data.cid,subi3:i.data.its,subi7:i.data.inited};a&&h(a,s);const o="https://event.api.umgame.cn/api/v1/event?"+u(s,"&");return n.get(o)})}onShareAppMessage(t,e){const a=this;this.fetchShareQuery().then(i=>{b(function(){const s=e();return a.shareMaterial.title&&(s.title=a.shareMaterial.title),a.shareMaterial.image&&(s.imageUrl=a.shareMaterial.image),s.query?s.query=s.query+"&"+i:s.query=i,s.query=s.query+"&ssid="+t,a.isShareDialogVisible=!0,s})},t=>{a.isShareDialogVisible=!0,b(e)})}shareAppMessage(t){if(!t.slotId||!t.data)throw Error("`obj.slotId` and `obj.data` are required by shareAppMessage");const e=this;this.fetchShareQuery().then(a=>{if(e.shareMaterial.title&&(t.data.title=e.shareMaterial.title),e.shareMaterial.image&&(t.data.imageUrl=e.shareMaterial.image),t.data.query?t.data.query=t.data.query+"&"+a:t.data.query=a,t.data.query=t.data.query+"&ssid="+t.slotId,e.isShareDialogVisible=!0,t.data.success){const e=t.data.success;t.data.success=function(){e()},y(t.data)}else y(t.data)},a=>{e.isShareDialogVisible=!0,y(t.data)})}createIconAd(t){if(!t.slotId)throw Error("obj.slotId is required by createIconAd(obj)");return new class{constructor(t,e){this.runtime=e,this.data={stype:"icon",sid:t.slotId,limit:t.limit||10,min_size:t.min_size||0,max_size:t.max_size||0,cdn:t.cdn},this.data.limit<=0&&(this.data.limit=1)}load(){const t=this;return t.runtime.wait4init().then(function(){const e={};return h(t.data,e),h(t.runtime.data,e),n.post("https://gw.api.umgame.cn/api/v1/slot",{},e).then(function(e){if(0!==e.c)throw Error(e.m);const a=e.d,i=[];for(let e=0;e<a.length;e++){a[e].sid=t.data.sid;const s=new v(a[e],t.runtime);i.push(s)}return t.onLoadCallback&&t.onLoadCallback(i),i}).catch(function(e){return t.onErrorCallback&&t.onErrorCallback(e),e})})}onLoad(t){this.onLoadCallback=t}onError(t){this.onErrorCallback=t}}(t,this)}createBannerAd(t){if(!t.adUnitId)throw Error("obj.adUnitId is required by createBannerAd(obj)");if(!t.slotId)throw Error("obj.slotId is required by createBannerAd(obj)");return new r(t,this)}createInterstitialAd(t){if(!t.adUnitId)throw Error("obj.adUnitId is required by createInterstitialAd(obj)");if(!t.slotId)throw Error("obj.slotId is required by createInterstitialAd(obj)");return new d(t,this)}createRewardedVideoAd(t){if(!t.adUnitId)throw Error("obj.adUnitId is required by createRewardedVideoAd(obj);");if(!t.slotId)throw Error("obj.slotId is required by createRewardedVideoAd(obj)");return new f(t,this)}createNativeAd(t){if(!t.adUnitId)throw Error("obj.adUnitId is required by createNativeAd(obj)");if(!t.slotId)throw Error("obj.slotId is required by createNativeAd(obj)");return new _(t,this)}createGridAd(t){if(!t.adUnitId)throw Error("obj.adUnitId is required by createGridAd(obj)");if(!t.slotId)throw Error("obj.slotId is required by createGridAd(obj)");return new L(t,this)}listMyModules(t){const e=this;return new Promise((t,a)=>{const i="https://gw.api.umgame.cn/api/v1/my_modules?"+u({sdkv:e.data.sdkv,gid:e.data.gid,uid:e.data.uid},"&");n.get(i).then(e=>{0===e.c?t(e.d):a(Error(e.m))}).catch(a)})}listPositionModules(t){const e=this;return new Promise((a,i)=>{const s="https://gw.api.umgame.cn/api/v1/position_modules?"+u({sdkv:e.data.sdkv,gid:e.data.gid,uid:e.data.uid,position:t.position,page:t.page,page_size:t.page_size},"&");n.get(s).then(t=>{0===t.c?a(t.d):i(Error(t.m))}).catch(i)})}listRankModules(t){const e=this;return new Promise((a,i)=>{const s="https://gw.api.umgame.cn/api/v1/rank_modules?"+u({sdkv:e.data.sdkv,gid:e.data.gid,uid:e.data.uid,page:t.page,page_size:t.page_size},"&");n.get(s).then(t=>{0===t.c?a(t.d):i(Error(t.m))}).catch(i)})}createModule(t){const e=this;return new Promise((a,i)=>{n.post("https://gw.api.umgame.cn/api/v1/create_module",{},h(e.data,{introduction:t.introduction,data:t.data})).then(t=>{0===t.c?a(t.d):i(Error(t.m))}).catch(i)})}updateModule(t){const e=this;return new Promise((a,i)=>{n.post("https://gw.api.umgame.cn/api/v1/update_module",{},h(e.data,{mid:t.mid,introduction:t.introduction,data:t.data})).then(t=>{0===t.c?a(t.d):i(Error(t.m))}).catch(i)})}downloadModule(t){const e=this;return new Promise((a,i)=>{const s="https://gw.api.umgame.cn/api/v1/download_module?"+u({sdkv:e.data.sdkv,gid:e.data.gid,uid:e.data.uid,mid:t.mid},"&");n.get(s).then(s=>{if(0===s.c){const i=s.d;if(t.add_to_downloaded_modules){const a={...i};delete a.data,w({key:"umsdk:downloaded_module:"+t.mid,data:JSON.stringify(i)}),e.listDownloadedModules().then(e=>{(e=e.filter(e=>e.mid!==t.mid)).unshift(a),w({key:"umsdk:downloaded_modules",data:JSON.stringify(e)})})}a(i)}else i(Error(s.m))}).catch(i)})}searchModule(t){const e=this;return new Promise((a,i)=>{const s="https://gw.api.umgame.cn/api/v1/search_module?"+u({sdkv:e.data.sdkv,gid:e.data.gid,mid:t.mid},"&");n.get(s).then(t=>{0===t.c?a(t.d):i(Error(t.m))}).catch(i)})}deleteModule(t){const e=this;return new Promise((a,i)=>{n.post("https://gw.api.umgame.cn/api/v1/delete_module",{},h(e.data,{mid:t.mid})).then(t=>{0===t.c?a(t.d):i(Error(t.m))}).catch(i)})}listDownloadedModules(){return new Promise((t,e)=>{g({key:"umsdk:downloaded_modules",success:e=>{t(JSON.parse(e.data))},fail:e=>{t([])}})})}deleteDownloadedModule(t){return new Promise((e,a)=>{const i="umsdk:downloaded_modules";g({key:i,success:a=>{let s=JSON.parse(a.data);s=s.filter(e=>e.mid!==t.mid),w({key:i,data:JSON.stringify(s),complete:t=>{e()}})},fail:t=>{e()}})})}getDownloadedModule(t){return new Promise((e,a)=>{g({key:"umsdk:downloaded_module:"+t.mid,success:t=>{e(JSON.parse(t.data))},fail:t=>{e(null)}})})}uploadModuleImage(t){const e=this;return new Promise((a,i)=>{!function(t){wx.uploadFile(t)}({url:"https://gw.api.umgame.cn/api/v1/upload_module_image",filePath:t.path,name:"file",formData:e.data,success(t){const e=JSON.parse(t.data);0===e.c?a(e.d.url):i(Error(e.m))},fail:t=>{a(t)}})})}getGift(){const t=this;return new Promise((e,a)=>{const i="https://gw.api.umgame.cn/api/v1/gift?"+u({sdkv:t.data.sdkv,gid:t.data.gid,uid:t.data.uid},"&");n.get(i).then(t=>{0===t.c?e(t.d.orders):a(Error(t.m))}).catch(a)})}}})();var Kt=new class{constructor(){this._sdkVersion="0.0.6",this._urlPath="https://aliyun.umgame.cn/game-assets/wxconfig/main/",this._interstitialAd=[],this._interIndex=-1,this._rewardedVideoAds=[],this._BannerAds=[],this._BannerAdsStatus=[],this._BannerAdsIndex=[],this._BannerAdsDestory=[],this._CustomAds=[],this._CustomCBs=[],this._BannerTimeOutIds=[],this._PosCallTime={},this._PosRealCallTime={},this._PageCB={},this._firstTimeVideo=0,this._platform=window.wx,this._succesTimes={},this._lifeAdTimes={},this._storageDataKey="SDKStorageDatas",this._storageDataTimeKey="SDKStorageTime",this._storageAdKey="WXADDatas",this._storageData={},this._lastTimeSendStorage=0,this.umsdk=$t}async InitSdk(t,e,a=!0){var i=new Date;const s=new Date(i.getFullYear(),0,0),o=i-s+60*(s.getTimezoneOffset()-i.getTimezoneOffset())*1e3;return this._dayOfYear=Math.floor(o/864e5),new Promise(async(i,s)=>{if(this._platform){this.GetStroageData();const s=this._platform.getLaunchOptionsSync();this._wxSystemInfo=this._platform.getSystemInfoSync(),this._gameVersion=e,this._gameId=t,this.log(`V:${this._sdkVersion} G:${this._gameVersion} I:${this._gameId}`),this._config=await this._GetJson(s.scene),this._config&&await this._initWxAd(),a&&(this.umsdk.init({gameId:this._gameId}),await this.getStorage(),this.log("getStorage",this._storageData),i())}i()})}GetStroageData(){let t="";null!=(t=this._platform.getStorageSync(this._storageAdKey))&&""!=t&&(this._lifeAdTimes=JSON.parse(t)),this._platform.setStorageSync(this._storageAdKey,JSON.stringify(this._lifeAdTimes))}async GetAdById(t){return new Promise(async(e,a)=>{if(this._platform&&this._platform.reportEvent("get_ad",{key:t}),this.log(0,t),null==this._config)return this.log(-1),void e("");if(null==this._config.AdDatas)return this.log(-2),void e("");var i=this._config.AdDatas[t];if(null==i)return this.log(-3),void e("");if("Video"!=t&&"FirstTimeVideo"!=t){for(let t=0;t<this._BannerAds.length;t++)this._HideBanner(t);for(let t=0;t<this._CustomAds.length;t++)this._HideCustom(t);0!=this._AdTimeId&&(clearTimeout(this._AdTimeId),this._AdTimeId=0)}if(i.need){var s=!0;for(let t=0;t<i.need.length;t++){const e=i.need[t];this._PosCallTime[e]||(s=!1)}if(!s)return void e("")}if(i.showNeed){s=!0;for(let t=0;t<i.showNeed.length;t++){const e=i.showNeed[t];this._PosRealCallTime[e]||(s=!1)}if(!s)return void e("")}if(this._PosCallTime[t]?this._PosCallTime[t]++:this._PosCallTime[t]=1,this.log(1,this._PosCallTime[t]),1==this._PosCallTime[t]&&i.first)e(await this.GetAdById(i.first));else{if(i.begin&&this._PosCallTime[t]<i.begin)return this.log(101,i.default),i.default&&await this.GetAdById(i.default),void e("");if(i.gap&&(this._PosCallTime[t]-(i.begin?i.begin:0))%i.gap!=0)return this.log(102,i.default),i.default&&await this.GetAdById(i.default),void e("");if(i.max&&i.max>0&&this._succesTimes[t]&&this._succesTimes[t]>=i.max)return this.log(103,this._succesTimes[t],i.max),i.default&&await this.GetAdById(i.default),void e("");if(i.lifeMax&&i.lifeMax>0&&this._lifeAdTimes[t]&&this._lifeAdTimes[t]>=i.lifeMax)return this.log(104,this._lifeAdTimes[t],i.lifeMax),i.default&&await this.GetAdById(i.default),void e("");if(i.otherChances&&i.otherAds&&i.otherChances.length==i.otherAds.length&&i.otherAds.length>0){var o=0;for(let t=0;t<i.otherChances.length;t++)o+=i.otherChances[t];var n=Math.random()*(o>=1?o:1);this.log("random "+n);for(let t=0;t<i.otherChances.length;t++)if(n-=i.otherChances[t],this.log("randomNext "+n),n<=0)return await this.GetAdById(i.otherAds[t]),void e("")}if(this._PosRealCallTime[t]?this._PosRealCallTime[t]++:this._PosRealCallTime[t]=1,this.log(10,this._PosRealCallTime[t]),i.before)for(let t=0;t<i.before.length;t++){const e=i.before[t];await this.GetAdById(e)}for(var r,l=1;l>0;){for(let t=0;t<i.steps.length;t++)r=await this._GetStepByData(i,t);l--}if(i.after)for(let t=0;t<i.after.length;t++){const e=i.after[t];r=await this.GetAdById(e)}i.max&&i.max>0&&(this._succesTimes[t]?this._succesTimes[t]++:this._succesTimes[t]=1),i.lifeMax&&i.lifeMax>0&&(this._lifeAdTimes[t]?this._lifeAdTimes[t]++:this._lifeAdTimes[t]=1,this._platform.setStorageSync(this._storageAdKey,JSON.stringify(this._lifeAdTimes))),e(r)}})}_GetStepByData(t,e){return new Promise((a,i)=>{var s=t.types[e],o=t.steps[e];if(this.log(2,s,o),null==s||null==s)return this.log(200,s),void a(void 0);var n=t.steps[e+1],r=t.chances?t.chances[e]:1,l=Math.random();if(l>r)return this.log(201,l,r),void a(void 0);if(null!=n&&0==n||o==n){if("Video"==s)this._showVideo();else if("Inter"==s)this._ShowInter(()=>{});else if(s.includes("Custom"))if(s.includes("CustomHide")){var h=(u=s.split("_")).length>1?Number(u[1]):0;this._HideCustom(h)}else h=(u=s.split("_")).length>1?Number(u[1]):0,this._ShowCustom(h);else if(s.includes("Banner"))s.includes("BannerHide")?(h=(u=s.split("_")).length>1?Number(u[1]):0,this._HideBanner(h)):(h=(u=s.split("_")).length>1?Number(u[1]):0,this._ShowBanner(h));else{if(s.includes("Time")){var d=(u=s.split("_")).length>1?Number(u[1]):0;return void(this._AdTimeId=setTimeout(()=>{this._AdTimeId=-1,a(void 0)},1e3*d))}var c=(u=s.split("_"))[0];if(h=u.length>1?Number(u[1]):0,this._PageCB[c])return void this._PageCB[c](h).then(()=>{a(void 0)}).catch(()=>{a(void 0)})}return this.log(202,s),void a(void 0)}if("Video"==s)this._showVideo(t=>{a(t)},()=>{a("Error")});else if("Inter"==s)this._ShowInter(()=>{a(void 0)});else if(s.includes("Custom"))s.includes("CustomHide")?(h=(u=s.split("_")).length>1?Number(u[1]):0,this._HideCustom(h),a(void 0)):(h=(u=s.split("_")).length>1?Number(u[1]):0,this._ShowCustom(h,()=>{a(void 0)}));else if(s.includes("Banner"))s.includes("BannerHide")?(h=(u=s.split("_")).length>1?Number(u[1]):0,this._HideBanner(h),a(void 0)):(h=(u=s.split("_")).length>1?Number(u[1]):0,this._ShowBanner(h),a(void 0));else if(s.includes("Time"))d=(u=s.split("_")).length>1?Number(u[1]):0,this._AdTimeId=setTimeout(()=>{this._AdTimeId=-1,a(void 0)},1e3*d);else{var u;c=(u=s.split("_"))[0],h=u.length>1?Number(u[1]):0,null!=this._PageCB[c]?this._PageCB[c](h).then(()=>{a(void 0)}).catch(()=>{a(void 0)}):a(void 0)}})}GetConfigById(t){var e="";return this._config&&this._config.Value&&null!=this._config.Value[t]&&(e=this._config.Value[t]),this.log("3",t,e),e}RegistPage(t,e){this.log("4",t),this._PageCB[t]=e}_GetJson(t){return new Promise(async(e,a)=>{if(1017==t){var i=await this._Request(`${this._urlPath}${this._gameId}/check.json?timeStamp=`+(new Date).getTime());if(i)return this.log("get check"),this.log(-5),void e(i)}var s=this._platform.getStorageSync("UMUserFrom");s&&""!==s||(s=t.toString(),this._platform.setStorageSync("UMUserFrom",s));var o=await this._Request(`${this._urlPath}${this._gameId}/${this._gameVersion}.json?timeStamp=`+(new Date).getTime()),n=!1;if(o){0==o.Status&&(this.log(-6),n=!0),o.Scene.includes(s)&&(this.log(-7,o.Scene,s),n=!0);var r=await this._Request("https://tracking.umgame.cn/api/v1/ip_info");0==r.c?""==r.d.city_zh||""==r.d.province_zh?(this.log(-9,o.City,r),n=!0,this._platform&&this._platform.reportEvent("err_pos",{key:r.d.province_zh+r.d.city_zh})):(o.City.includes(r.d.city_zh)||o.City.includes(r.d.province_zh))&&(this.log(-8,o.City,r.d.city_zh,r.d.province_zh),n=!0):n=!0}else n=!0;n?(this.log("get default"),o=await this._Request(`${this._urlPath}${this._gameId}/default.json?timeStamp=`+(new Date).getTime())):this.log(`get ${this._gameVersion}`),e(o)})}async _Request(t,e=0){return new Promise((a,i)=>{if(this._platform&&this._platform.request)this._platform.request({url:t,method:"GET",dataType:"json",timeout:3e3,success:t=>{200===t.statusCode?(this.log("Request success: ",t.data),a(t.data)):s(a)},fail:t=>{this.log("Request failed: ",t),s(a)}});else{const e=new XMLHttpRequest;e.onreadystatechange=(()=>{e.readyState===XMLHttpRequest.DONE&&(200===e.status?(this.log("Request success:",e.response),a(JSON.parse(e.response))):(this.log("Request failed:",e.statusText),s(a)))}),e.open("GET",t+"?timeStamp="+(new Date).getTime()),e.send()}const s=a=>{a(e<3?this._Request(t,e+1):void 0)}})}_initWxAd(){return new Promise(async(t,e)=>{await this._InitBanner(),await this._InitVideo(),await this._InitInter(),await this._InitCustom(),t()})}_InitCustom(){if(null!=this._config){var t=this._wxSystemInfo.windowWidth,e=this._wxSystemInfo.windowHeight,a=this._wxSystemInfo.statusBarHeight;for(let n=0;n<this._config.CustomIds.length;n++){const r=this._config.CustomIds[n];var i=this._config.CustomStyles[n];null==i&&(i=this._config.CustomStyles[0]);var s=0;switch(i.Hor){case-1:s=i.HorValue;break;case 0:s=t/2+i.HorValue;break;case 1:s=t-i.HorValue}var o=0;switch(i.Ver){case-1:o=i.Bar?i.VerValue+a:i.VerValue;break;case 0:o=e/2+i.VerValue;break;case 1:o=e-i.VerValue}const l={};l.adUnitId=r,l.style={left:s,top:o,width:i.Width?i.Width:320},l.adIntervals=30,this._InitSimpleCustom(l,r,n)}}}_InitSimpleCustom(t,e,a){const i=this._platform.createCustomAd(t);this._CustomAds[a]=i,i.onLoad(()=>this.log("Custom onLoad",e)),i.onError(t=>this.log("Custom onError",e,JSON.stringify(t))),i.onClose(()=>{this.log("Custom onClose",e),this._CallCustomcb(a);let i=setTimeout(()=>{this._InitSimpleCustom(t,e,a),clearTimeout(i)},1e3)}),i.onHide(()=>{this.log("Custom onHide",e),this._CallCustomcb(a)})}_ShowCustom(t,e){null!=this._wxSystemInfo?(this._CustomCBs[t]=e,this._CustomAds[t].show().then(()=>this.log("Custom show",this._config?this._config.CustomIds[t]:void 0)).catch(e=>{this.log("Custom show catch",this._config?this._config.CustomIds[t]:void 0),this._CallCustomcb(t)})):e&&e()}_HideCustom(t){null!=this._wxSystemInfo&&this._CustomAds[t].hide()}_CallCustomcb(t){this._CustomCBs[t]&&this._CustomCBs[t](),this._CustomCBs[t]=null}_InitInter(){if(null!=this._config)for(let e=0;e<this._config.InterId.length;e++){const a=this._config.InterId[e],i={};i.adUnitId=a;var t=this._platform.createInterstitialAd(i);t.onLoad(()=>{this.log("inter onLoad")}),t.onError(t=>{this.log("inter onError",JSON.stringify(t))}),t.onClose(t=>{this.log("inter onClose"),null!=this._interCB&&(this._interCB(),this._interCB=void 0)}),this._interstitialAd.push(t)}}_ShowInter(t){null!=this._wxSystemInfo?0!=this._interstitialAd.length?(this._interIndex++,this._interIndex>=this._interstitialAd.length&&(this._interIndex=0),this._interCB=void 0,null!=t&&(this._interCB=t),this._interstitialAd[this._interIndex].show().catch(t=>{this.log("inter show catch",JSON.stringify(t)),null!=this._interCB&&(this._interCB(),this._interCB=void 0)})):this.log("inter none"):t&&t()}_InitVideo(){if(null!=this._config){var t=[];if(t.push(this._config.RewardId),null!=this._config.RewardIdList&&this._config.RewardIdList.length>0)t=this._config.RewardIdList;else if(this._config.RewardIds)if(null!=this._config.RewardIndex)t[0]=this._config.RewardIds[this._config.RewardIndex],this.log(1021,this._config.RewardIndex);else{var e=this._dayOfYear%this._config.RewardIds.length;t[0]=this._config.RewardIds[e],this.log(1022,e)}for(let e=0;e<t.length;e++){const i=t[e],s={};s.adUnitId=i,s.multiton=!0;var a=this._platform.createRewardedVideoAd(s);a.onLoad(()=>{this.log("video onLoad"),0==this._firstTimeVideo&&(this._firstTimeVideo++,this.GetAdById("FirstTimeVideo"))}),a.onError(t=>{this.log("video onError",i,JSON.stringify(t))}),a.onClose(t=>{t&&t.isEnded||void 0===t?this._VideoCB&&(this._VideoCB("Success"),this._VideoCB=void 0):this._VideoCB&&(this._VideoCB("Fail"),this._VideoCB=void 0),a.load()}),a.load(),this._rewardedVideoAds.push(a)}}}_showVideo(t,e){null!=this._wxSystemInfo?(this._VideoCB=t,this._VideoFailCB=e,this._showSingleVideo(0)):t&&t("Success")}_showSingleVideo(t){this._rewardedVideoAds[t]?this._rewardedVideoAds[t].show().then(()=>this.log("video show")).catch(()=>this._showSingleVideo(t+1)):this._VideoFailCB&&this._VideoFailCB()}_InitBanner(){if(null!=this._config)for(let t=0;t<this._config.BannerIds.length;t++)this._CreateBanner(t)}_CreateBanner(t){if(null!=this._config){var e=this._wxSystemInfo.windowWidth,a=this._wxSystemInfo.windowHeight,i="";if(this._config.BannerIds.some(t=>t instanceof Array)){var s=0;this._config.BannerIndexs?(s=this._config.BannerIndexs[t]||0,this.log(1011,t,s)):(s=this._dayOfYear%this._config.BannerIds[t].length,this.log(1012,t,s)),i=this._config.BannerIds[t][s]}else i=this._config.BannerIds[t];var o=i.split(","),n=this._config.BannerStyles[t];if(null==n&&(n=this._config.BannerStyles[0]),this._BannerAds[t])for(const e in this._BannerAds[t])if(Object.prototype.hasOwnProperty.call(this._BannerAds[t],e)){const a=this._BannerAds[t][e];a&&a.destroy()}this._BannerAds[t]=[],this._BannerAdsStatus[t]=!1,0!=o.length&&(this._BannerAdsIndex[t]=Math.floor(Math.random()*o.length*20)%o.length),this._BannerAdsDestory[t]=0;for(let i=0;i<o.length;i++){const s=o[i],c={};c.adUnitId=s;var r=0,l=0,h=n.Width?n.Width:320,d=n.Height;switch(n.Hor){case-1:r=n.HorValue;break;case 0:r=(e-h)/2+n.HorValue;break;case 1:r=e-n.HorValue}switch(n.Ver){case-1:l=n.VerValue;break;case 0:l=(a-d)/2+n.VerValue;break;case 1:l=a-d-n.VerValue}c.style={left:r,top:l,width:n.Width?n.Width:320,height:n.Height};const u=this._platform.createBannerAd(c);this._BannerAds[t].push(u),u.onError(t=>{this.log("banner onError",s,JSON.stringify(t))}),u.onLoad(()=>{this.log("banner onLoad")}),u.onResize(t=>{switch(n.Hor){case-1:u.style.left=n.HorValue;break;case 0:u.style.left=(e-t.width)/2+n.HorValue;break;case 1:u.style.left=e-n.HorValue}switch(n.Ver){case-1:u.style.top=n.VerValue;break;case 0:u.style.top=(a-t.height)/2+n.VerValue;break;case 1:u.style.top=a-t.height-n.VerValue}})}}}_ShowBanner(t){null!=this._wxSystemInfo&&null!=this._config&&(this._BannerAdsStatus[t]=!0,-1!=this._BannerTimeOutIds[t]&&(clearTimeout(this._BannerTimeOutIds[t]),this._BannerTimeOutIds[t]=-1),this._BannerAdsIndex[t]>=this._BannerAds[t].length&&(this._BannerAdsIndex[t]=0),this._BannerAds[t][this._BannerAdsIndex[t]].show().then(()=>{this.log("banner show");var e=setTimeout(()=>{this._BannerAdsStatus[t]&&(this._HideBanner(t,!1),this._NextBanner(t),this._ShowBanner(t))},1e3*(this._config?this._config.BannerRefreshTime:0));this._BannerTimeOutIds[t]=e}).catch(e=>{this.log("banner show catch",JSON.stringify(e)),this._NextBanner(t),this._BannerAdsStatus[t]&&this._ShowBanner(t)}))}_NextBanner(t){this._BannerAdsIndex[t]++,this._BannerAdsIndex[t]>=this._BannerAds[t].length&&(this._BannerAdsIndex[t]=0,this._BannerAdsDestory[t]++,this._BannerAdsDestory[t]>(this._config?this._config.BannerDestroyRefresh:9999)&&this._CreateBanner(t))}_HideBanner(t,e=!0){null!=this._wxSystemInfo&&(this._BannerAdsStatus[t]=!1,this._BannerAds[t][this._BannerAdsIndex[t]].hide().then(()=>this.log("banner hide")).catch(t=>this.log("banner hide catch",JSON.stringify(t))),e&&-1!=this._BannerTimeOutIds[t]&&(clearTimeout(this._BannerTimeOutIds[t]),this._BannerTimeOutIds[t]=-1))}log(...t){var e=1;this._config&&(e=this._config.Log),e&&console.log("[WxSDK] ",t)}getLocalData(){const t=this._platform.getStorageSync(this._storageDataKey);return null!=t&&""!=t?JSON.parse(t):null}async getOnlineData(){const t=await this.umsdk.fetchSubParams();return null!=t&&null!=t[this._storageDataKey]?JSON.parse(t[this._storageDataKey]):null}async getStorage(){const t=this.getLocalData(),e=await this.getOnlineData();if(this.log("StorageData",t,e),null!=t&&null!=e){const a=t[this._storageDataTimeKey],i=e[this._storageDataTimeKey];this.log("localTime",a),this.log("onlineTime",i),i>a?(this._storageData=e,this.log("Load onlineData",this._storageData)):(this._storageData=t,this.log("Load localData",this._storageData))}else null!=t&&null==e?(this.log("LocalData not null, onlineData is null"),this._storageData=t):null==t&&null!=e&&(this.log("LocalData is null, onlineData not null"),this._storageData=e)}GetStorage(t){return this.log("GetStorage",t,this._storageData[t]),this._storageData[t]}SetStorage(t,e){this.log("SetStorage",t,e);var a=Date.now();this._storageData[t]=e,this._storageData[this._storageDataTimeKey]=a,this._platform.setStorageSync(this._storageDataKey,JSON.stringify(this._storageData)),this.log("CheckNeedSave",(a-this._lastTimeSendStorage)/1e3),a-this._lastTimeSendStorage>6e4&&(this.log("BeginSave",JSON.stringify(this._storageData)),this._lastTimeSendStorage=a,this.umsdk.subscribePost([{key:this._storageDataKey,val:JSON.stringify(this._storageData)}]))}GetRankList(t,e,a,i,s,o){return this.umsdk.GetRankList({type:t,top_n:e,created_at_begin:a,created_at_end:i,updated_at_begin:s,updated_at_end:o,page:1,page_size:e})}SetRank(t,e,a){this.umsdk.SetRank({type:t,score:e,extra_data:JSON.stringify(a)})}};null==window.wxsdk&&(window.wxsdk={});var Qt=window.wxsdk;Qt.InitSdk=Kt.InitSdk.bind(Kt),Qt.GetAdById=Kt.GetAdById.bind(Kt),Qt.GetConfigById=Kt.GetConfigById.bind(Kt),Qt.RegistPage=Kt.RegistPage.bind(Kt),Qt.GetStorage=Kt.GetStorage.bind(Kt),Qt.SetStorage=Kt.SetStorage.bind(Kt),Qt.GetRankList=Kt.GetRankList.bind(Kt),Qt.SetRank=Kt.SetRank.bind(Kt),Qt.umsdk=Kt.umsdk;var Zt=["BoxPage","CustomAdPage","MorePage"];for(let t=0;t<Zt.length;t++){const e=Zt[t];console.log(e),wxsdk.RegistPage(e,t=>new Promise((a,i)=>{var s=Laya.Browser.height>Laya.Browser.width?"wxsdkV":"wxsdkH";Laya.View.open(`style1/${s}/${e}.scene`,!1,{index:t,closeCB:a},new Laya.Handler(void 0,t=>{t?(t.width=Laya.stage.width,t.height=Laya.stage.height,t.pos(0,0)):(a(),console.error(`wxsdk 缺少页面${e}`))}))}))}class te extends Laya.Script{constructor(){super(),this.soundOn="sound/MenuOpen.mp3",this.soundOff="sound/MenuClose.mp3"}onClick(t){if(this.owner.gray||this.owner.grayStatus){if(!this.soundOff)return;x.audio.playSound(this.soundOff)}else{if(!this.soundOn)return;x.audio.playSound(this.soundOn)}i.vibrateShort()}}new class{constructor(){UIConfig.closeDialogOnSide=!1,UIConfig.popupBgAlpha=.85;let t=new Config3D;t.isAntialias=!0,t.enableMultiLight=!1,window.Laya3D&&Laya3D.init(Jt.width,Jt.height,t,Laya.Handler.create(this,()=>{Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=Jt.scaleMode,Laya.stage.screenMode=Jt.screenMode,Laya.stage.alignV=Jt.alignV,Laya.stage.alignH=Jt.alignH,Laya.URL.exportSceneToJson=Jt.exportSceneToJson,(Jt.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),Jt.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),Jt.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),x.I,Laya.stage.on(Laya.Event.CLICK,this,t=>{if("btn"===t.target.name.toLowerCase().substr(0,3)||"close"===t.target.name){if(t.target.getComponent(te))return;x.audio.playSound("sound/click.mp3"),i.vibrateShort()}}),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}))}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){Jt.startScene&&Laya.Scene.open(Jt.startScene)}}}();